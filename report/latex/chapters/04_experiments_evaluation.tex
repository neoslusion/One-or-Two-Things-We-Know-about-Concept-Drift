\chapter{Thực nghiệm và đánh giá}
\label{chap:experiments}

\section{Tổng quan thực nghiệm}
\label{sec:overview}

\subsection{Mục tiêu và Cấu trúc chương}
Chương này đi sâu phân tích các kết quả thực nghiệm nhằm minh chứng cho tính hiệu quả của hệ thống đề xuất. Khung đánh giá được thiết kế chặt chẽ với ba yếu tố chính, tương ứng với các module xử lý của hệ thống:
\begin{enumerate}
	\item \textbf{Đánh giá khả năng phát hiện Drift (Detection Benchmark):} Đối chiếu hiệu suất của ShapeDD và biến thể cải tiến (IDW-MMD với asymptotic p-value) với các phương pháp nền tảng (Baseline) trên đa dạng các tập dữ liệu.
	\item \textbf{Đánh giá khả năng phân loại drift của SE-CDT:} Kiểm chứng độ chính xác trong việc định danh loại drift (sudden, gradual, incremental, recurrent, blip) dựa trên phân tích tín hiệu drift magnitude.
	\item \textbf{Đánh giá khả năng thích ứng (Adaptation Evaluation):} Xác thực hiệu quả thực tế của các chiến lược cập nhật mô hình tự động thông qua chỉ số độ chính xác cuốn chiếu (Prequential Accuracy).
\end{enumerate}

\subsection{Môi trường và Cấu hình}
\label{sec:dataset-config}
Thay vì liệt kê một cấu hình chung thiếu chính xác, các tham số môi trường và thuật toán sẽ được mô tả cụ thể gắn liền với từng kịch bản thử nghiệm (Detection, Classification, Adaptation). Cách tiếp cận này nhằm đảm bảo tính minh bạch và khả năng tái lập kết quả một cách chính xác nhất.

\textbf{Quy ước ký hiệu trong các bảng:}
\begin{itemize}
	\item \textbf{MMD-IDW}: Inverse Density-Weighted MMD, sử dụng trọng số nghịch mật độ.
	\item \textbf{ShapeDD-IDW}: ShapeDD với IDW-MMD và asymptotic p-value.
	\item \textbf{SE-CDT}: Phương pháp thống nhất phát hiện và phân loại drift.
\end{itemize}

\subsection{Tập dữ liệu thực nghiệm}

Hệ thống được đánh giá trên bộ 10 tập dữ liệu tổng hợp (synthetic datasets) và một tập dữ liệu thực tế (realworld datasets), được thiết kế để kiểm tra các khía cạnh cụ thể của thuật toán phát hiện. Các tập dữ liệu được phân loại dựa trên bản chất của sự thay đổi phân phối:

\textbf{Nhóm 1: Sudden Drift (Thay đổi P(X) đột ngột).}
Đây là trọng tâm chính của ShapeDD và IDW-MMD. Các dataset này chứa sự thay đổi đột ngột trong phân phối đầu vào $P(X)$ (Covariate Shift), nơi các phương pháp unsupervised cần phải phát hiện chính xác.
\begin{itemize}
	\item \textit{Gaussian Shift (Moderate):} Dữ liệu phân phối chuẩn đa chiều ($d=10$) với sự dịch chuyển trung bình (mean shift) đột ngột ($\delta=1.5$). Đây là trường hợp lý tưởng để kiểm tra độ nhạy của kernel RBF.
	\item \textit{STAGGER Concepts:} Bộ dữ liệu kinh điển với các đặc trưng nhị phân. Mặc dù thường được dùng cho supervised drift, nó cũng chứa sự thay đổi phân phối $P(X)$ do cách lấy mẫu, tạo ra tín hiệu drift rõ ràng.
	\item \textit{Random Uniform (Sensitivity Test):} Bộ 4 dataset (\textit{mild, moderate, severe, ultra\_severe}) được sinh ngẫu nhiên với cường độ thay đổi (intensity) tăng dần từ 0.125 đến 2.0. Bộ này dùng để đánh giá "ngưỡng phát hiện" (detection threshold) của các thuật toán.
	\item \textbf{\textit{Stepping Drift (Cumulative):}} Một biến thể quan trọng được thêm vào để kiểm chứng khả năng thích ứng. Khác với Sudden Drift thông thường (thường luân phiên A$\to$B$\to$A), Stepping Drift dịch chuyển phân phối tích lũy theo một hướng (A$\to$B$\to$C$\to$D). Điều này ngăn cản mô hình "học vẹt" các trạng thái cũ và buộc hệ thống phải thích ứng với dữ liệu hoàn toàn mới (out-of-distribution robustness).
\end{itemize}

\textbf{Nhóm 2: Blip Drift (Thay đổi ngắn hạn).}
\begin{itemize}
	\item \textit{RBF Blips:} Dữ liệu được sinh từ các trọng tâm Gaussian (50 centroids) di chuyển đột ngột và quay lại trạng thái cũ trong thời gian ngắn. Thử thách khả năng phát hiện sự thay đổi tạm thời của các thuật toán.
\end{itemize}

\textbf{Nhóm 3: Virtual Drift / Concept Drift thuần túy (Control Group).}
Nhóm này bao gồm các dataset chỉ có sự thay đổi về biên quyết định $P(Y|X)$ trong khi phân phối đầu vào $P(X)$ giữ nguyên (hoặc thay đổi không đáng kể).
\begin{itemize}
	\item \textit{Standard SEA:} Thay đổi ngưỡng phân lớp $x_1 + x_2 > \theta$.
	\item \textit{Rotating Hyperplane:} Mặt siêu phẳng xoay dần trong không gian.
	\item \textit{LED Abrupt:} Thay đổi quy tắc hiển thị số trên đèn LED (7 features).
\end{itemize}

\textbf{Mục đích kiểm chứng:} Đối với các phương pháp phát hiện drift không giám sát (như ShapeDD, MMD), kết quả lý tưởng trên nhóm này là \textbf{không phát hiện} (hoặc phát hiện rất ít), vì $P(X)$ không đổi. Việc benchmark trên nhóm này giúp xác nhận thuật toán không bị "ảo giác" (hallucination) trước các thay đổi chỉ mang tính ngữ nghĩa nhãn.

\textbf{Nhóm 4: Dữ liệu thực tế có kiểm soát về các điểm trôi dạt.}
Nhóm này bao gồm dataset từ môi trường thực tế với các đặc trưng phức tạp và không xác định trước, nhưng được kiểm soát về các điểm trôi dạt để có thể đánh giá cách hoạt động của phương pháp trong môi trường làm việc thực tế.


\subsection{Chiến lược đánh giá}
\label{sec:eval-strategy}

Trước khi so sánh với các phương pháp hiện có, cần làm rõ kiến trúc của hệ thống đề xuất để định hình chiến lược đánh giá. Hệ thống SE-CDT-Stream được thiết kế theo kiến trúc modular gồm ba thành phần chính tương ứng với 3 giai đoạn xử lý:

\begin{enumerate}
	\item \textbf{Detection Module (ShapeDD-IDW):}
	Kết hợp ShapeDD với IDW-MMD và asymptotic p-value để phát hiện thời điểm xảy ra drift. Module này ưu tiên giảm thiểu Positive Rate (FP) và độ trễ.
	
	\item \textbf{Classification Module (SE-CDT):}
	Phân loại loại drift (sudden, gradual, incremental, recurrent, blip) dựa trên tín hiệu drift magnitude $\sigma(t)$. SE-CDT hoạt động hoàn toàn \textit{không giám sát} bằng cách phân tích hình dạng của $\sigma(t)$ trên các cửa sổ trượt đa kích thước.
	
	\item \textbf{Adaptation Module:}
	Kích hoạt chiến lược thích ứng phù hợp dựa trên kết quả classification: Full Reset (sudden), Incremental Update (gradual/incremental), Concept Memory (recurrent).
\end{enumerate}

Tương ứng với kiến trúc này, phần đánh giá sẽ được chia thành 3 phần: (1) Đánh giá Detection Module so với baseline, (2) Đánh giá Classification Module (SE-CDT) và lựa chọn tham số tối ưu, (3) Đánh giá hiệu quả thích ứng của toàn bộ pipeline (End-to-End).

\section{Đánh giá phương pháp phát hiện Drift}
\label{sec:detection-eval}

Mục này tập trung đối chiếu hiệu năng của Detection Module so với các phương pháp tiên tiến (SOTA) đại diện cho các trường phái khác nhau: KS-Test (thống kê cổ điển), MMD (kernel-based), DAWIDD (window-based), D3 (discriminative classifier), và ShapeDD gốc (2021). Trọng tâm phân tích được đặt vào khả năng nhận diện \textbf{Sự thay đổi phân phối đầu vào} $P(X)$ (Distribution Shift / Covariate Shift).

\subsection{Thiết lập thực nghiệm (Detection Setup)}
Các tham số cho bài toán benchmark phát hiện drift được thiết lập như sau (tương ứng với script \texttt{benchmark/main.py}):
\begin{itemize}
	\item \textbf{Dữ liệu:} 11 tập dữ liệu tổng hợp và thực tế (chi tiết ở Mục~\ref{sec:dataset-config}).
	\item \textbf{Kích thước luồng:} $T = 10,000$ mẫu mỗi dataset.
	\item \textbf{Số lượng drift:} 10 điểm drift được chèn tại các vị trí cố định (mỗi 1,000 mẫu) để tạo ground truth.
	\item \textbf{Quy trình đánh giá:} Thực hiện 30 lần chạy độc lập (30 runs) với các random seed khác nhau.
	\item \textbf{Độ trễ chấp nhận ($\delta$):} 250 mẫu. Nếu phát hiện nằm ngoài khoảng $[t_{drift}, t_{drift} + \delta]$, nó được tính là False Positive.
\end{itemize}

\subsection{Kết quả so sánh tổng hợp}

Bảng~\ref{tab:comprehensive_performance} so sánh hiệu suất của \textbf{phương pháp đề xuất} (IDW-MMD, ShapeDD-IDW, SE-CDT) với \textbf{các baseline} (Standard MMD, KS-Test, D3, DAWIDD, ShapeDD gốc). Các chỉ số F1 được tính dựa trên khả năng phát hiện đúng các điểm drift đã biết (ground truth), kết quả được tổng hợp từ 30 lần chạy độc lập trên 11 tập dữ liệu đã được nhắc đến ở trên.

% =============================================================================
% Bảng tổng hợp hiệu suất
% =============================================================================
\begin{table}[H]
	\centering
	\caption{So sánh tổng hợp hiệu suất các phương pháp phát hiện drift}
	\label{tab:comprehensive_performance}
	\input{../../results/tables/table_I_comprehensive_performance.tex}
\end{table}

\textbf{Phân tích kết quả:}
\begin{itemize}
	\item \textbf{IDW-MMD dẫn đầu về F1 (0.548):} Phương pháp này đạt F1-score cao nhất nhờ sự cân bằng giữa Precision (0.589) và Recall (0.567), với số báo động giả thấp (2.5 FP/run). Điều này xác nhận hiệu quả của cơ chế trọng số nghịch mật độ trong việc giảm độ dao động kết quả.
	\item \textbf{SE-CDT và ShapeDD-IDW (F1 = 0.481):} Hai phương pháp đề xuất đạt Precision cao (0.539) với \textbf{không có báo động giả} (FP = 0) trên benchmark detection. Đây là ưu điểm vượt trội so với các phương pháp giám sát (như DDM/ADWIN) thường báo động sai khi gặp Virtual Drift (thay đổi nhãn nhưng $P(X)$ giữ nguyên). Việc SE-CDT duy trì FP=0 trên các tập dữ liệu nhiễu nhãn (như \textit{standard\_sea}) chứng minh tính bền vững (robustness) của phương pháp unsupervised trong các hệ thống thực tế, giúp giảm thiểu hiện tượng mệt mỏi cảnh báo (alert fatigue) cho người vận hành.
	\item \textbf{D3 xếp thứ 2 (F1 = 0.488):} Phương pháp discriminative này hoạt động tốt với Precision cao (0.553) và FP thấp (0.9), nhưng Recall hạn chế (0.474) do phụ thuộc vào khả năng học của classifier.
	\item \textbf{MMD baseline (F1 = 0.455):} Phương pháp MMD chuẩn đạt Recall cao (0.722) nhưng Precision thấp (0.348), dẫn đến 14.3 báo động giả trung bình mỗi lần chạy.
	\item \textbf{Sự đánh đổi của KS-Test (F1 = 0.289):} Phương pháp Kolmogorov-Smirnov đạt Recall cao nhất (0.796) nhưng lại có Precision thấp nhất (0.188) với số lượng báo động giả lớn (36.6 FP/run). Điều này cho thấy KS quá nhạy cảm với nhiễu, không phù hợp cho các hệ thống giám sát tự động yêu cầu độ tin cậy cao.
\end{itemize}

\subsection{Phân tích ý nghĩa thống kê}

Để khẳng định sự khác biệt về hiệu suất không phải do ngẫu nhiên, biểu đồ Critical Difference (CD) sử dụng kiểm định Friedman và Nemenyi post-hoc test được trình bày trong Hình~\ref{fig:critical_difference}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\textwidth]{../../results/plots/critical_difference_f1.png}
	\caption[Biểu đồ Critical Difference (CD)]{Biểu đồ Critical Difference (CD) với mức ý nghĩa $\alpha = 0.05$. Kết quả cho thấy không có sự khác biệt thống kê đáng kể giữa SE\_CDT và nhóm dẫn đầu (MMD, MMD\_IDW).}
	\label{fig:critical_difference}
\end{figure}

Kết quả kiểm định Friedman cho thấy MMD cơ bản có thứ hạng trung bình tốt nhất (3.64), tiếp theo là IDW-MMD (3.91). SE-CDT và ShapeDD-IDW xếp hạng 4-5 (4.50) với Critical Difference = 3.0. Điều này cho thấy không có sự khác biệt thống kê có ý nghĩa lớn về F1 giữa các phương pháp top, nhưng \textbf{SE-CDT/ ShapeDD-IDW có sự khác biệt ở chỉ số FP = 0} --- yếu tố quan trọng trong môi trường production.

\subsection{Đánh giá chi tiết trên từng loại dữ liệu}

Hiệu suất của các phương pháp thay đổi tùy thuộc vào đặc tính của tập dữ liệu (Bảng~\ref{tab:f1_by_dataset_part1}, Bảng~\ref{tab:f1_by_dataset_part2} và Bảng~\ref{tab:f1_by_dataset_part3}).

% =============================================================================
% Bảng F1 theo Dataset
% =============================================================================
\begin{table}[H]
	\centering
	\caption{F1-Score theo dataset (Phần 1: Dữ liệu cơ bản và Mild/Moderate Drift)}
	\label{tab:f1_by_dataset_part1}
	\input{../../results/tables/table_II_part1.tex}
\end{table}

\begin{table}[H]
	\centering
	\caption{F1-Score theo dataset (Phần 2: Drift mạnh và thay đổi mặt phẳng)}
	\label{tab:f1_by_dataset_part2}
	\input{../../results/tables/table_II_part2.tex}
\end{table}

\begin{table}[H]
	\centering
	\caption{F1-Score theo dataset (Phần 3: Blip và dữ liệu Stagger/SEA)}
	\label{tab:f1_by_dataset_part3}
	\input{../../results/tables/table_II_part3.tex}
\end{table}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\textwidth]{../../results/plots/vis_mixed_a_SE.png}
	\caption[Minh họa tín hiệu phát hiện trên dữ liệu Sudden Drift]{Minh họa tín hiệu phát hiện trên dữ liệu Sudden Drift (trong kịch bản Mixed A). ShapeDD tạo ra hình dạng "tam giác cân" đặc trưng (Subplot 03) tại điểm drift, đúng như dự báo lý thuyết.}
	\label{fig:sudden_drift_vis}
\end{figure}

\textbf{Phân tích sâu:}
\begin{enumerate}
	\item \textbf{Kết quả trên Drift mạnh (Severe/Sudden):}
	      Trên các dataset như \textit{gaussian\_shift\_moderate}, \textit{stagger}, và \textit{gen\_random\_severe/ultra\_severe}, phương pháp ShapeDD-IDW và SE-CDT đạt F1 ở mức cao ($\geq 0.97$). Hình~\ref{fig:sudden_drift_vis} minh họa ShapeDD tạo thành hình tam giác đúng tại thời điểm drift.
	\item \textbf{Thách thức với Drift nhẹ (Mild Drift) và Cơ chế IDW-MMD:}
	      Trên tập \textit{gen\_random\_mild}, hiệu suất của SE-CDT/ ShapeDD-IDW giảm mạnh (F1 = 0.006) so với MMD truyền thống (F1 = 0.585).
	      \textit{Lý giải:} IDW-MMD gán trọng số thấp cho vùng mật độ cao, vô tình làm lu mờ tín hiệu drift nhẹ diễn ra trong vùng này (over-smoothing), dẫn đến tỷ lệ False Negative cao (xem Hình~\ref{fig:gradual_drift_vis}).
	\item \textbf{Hành vi trên Virtual Drift (Control Group):}
	      Trên các dataset \textit{hyperplane}, \textit{led\_abrupt}, và \textit{standard\_sea}, SE-CDT/ ShapeDD-IDW đạt F1 = 0.0. Đây là \textbf{hành vi mong đợi} vì các dataset này chỉ có sự thay đổi $P(Y|X)$. Khác với các baseline giám sát (supervised baselines) thường báo động sai khi Accuracy giảm, phương pháp unsupervised chỉ tập trung vào $P(X)$, giúp hệ thống không bị "đánh lừa" bởi các thay đổi chỉ mang tính chất nhãn (label shift) mà bản chất dữ liệu không đổi.
	\item \textbf{Blip Drift:}
	      Trên tập \textit{rbfblips}, SE\_CDT đạt F1 = 1.0. Cơ chế shape detection kết hợp IDW-MMD cho kết quả tốt với các thay đổi ngắn hạn, đột ngột.
	\item \textbf{Phân tích Báo động giả (False Positives):}
	      Hình~\ref{fig:stationary_fp} so sánh số lượng báo động giả. KS-Test tạo ra lượng báo động sai lớn nhất (36.6 FP/run). SE-CDT và ShapeDD-IDW duy trì \textbf{0 False Positives}, nhờ vào cơ chế shape detection chặt chẽ.
\end{enumerate}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\textwidth]{../../results/plots/vis_repeated_gradual_SE.png}
	\caption[Minh họa tín hiệu trên dữ liệu Gradual Drift]{Minh họa tín hiệu trên dữ liệu Gradual Drift. Tín hiệu (màu đỏ - Subplot 03) không tạo thành đỉnh nhọn rõ ràng mà bị san phẳng.}
	\label{fig:gradual_drift_vis}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\textwidth]{../../results/plots/figure_4_stationary_fp.png}
	\caption[Phân tích số lượng báo động giả trên tập dữ liệu tĩnh]{Phân tích số lượng báo động giả trên tập dữ liệu tĩnh (Stationary). KS tạo ra nhiều báo động sai nhất, trong khi các phương pháp MMD và D3 ổn định hơn.}
	\label{fig:stationary_fp}
\end{figure}

\subsection{Đánh giá hiệu suất tính toán (Runtime \& Throughput)}

Bảng~\ref{tab:runtime_stats} so sánh thời gian và thông lượng.

\begin{table}[H]
	\centering
	\caption{So sánh hiệu suất tính toán của các phương pháp}
	\input{../../results/tables/table_III_runtime_stats.tex}
\end{table}

\textbf{Trực quan hóa so sánh Runtime:}

Hình~\ref{fig:throughput-comparison} minh họa sự cải thiện vượt trội về thông lượng xử lý, trong khi chi tiết thời gian chạy cụ thể được liệt kê trong Bảng~\ref{tab:runtime_stats}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.85\textwidth]{../../results/plots/throughput_comparison.png}
	\caption[Throughput Comparison]{
		\textbf{Throughput (samples/sec)}: So sánh giữa CDT\_MSW (chỉ detection, $\sim$5,000 samples/s) và SE\_CDT (detection + classification, $\sim$500--2,000 samples/s). SE\_CDT chậm hơn do bổ sung module phân loại, nhưng vẫn đạt 131,579 samples/s trên benchmark detection riêng (xem Bảng~\ref{tab:runtime_stats}).
	}
	\label{fig:throughput-comparison}
\end{figure}

\textbf{Các kết quả chính:}
\begin{itemize}
	\item \textbf{Tăng tốc gấp 17--20 lần:} SE\_CDT đạt thông lượng $\sim 131,500$ mẫu/giây (7.6ms/window), nhanh gấp \textbf{20.5 lần} so với ShapeDD gốc ($\sim 7,987$ mẫu/giây).
	\item \textbf{Ý nghĩa thực tiễn:} Với thông lượng $>100,000$ mẫu/giây, hệ thống đủ khả năng đáp ứng các ứng dụng yêu cầu độ trễ thấp như giám sát log máy chủ hay giao dịch tài chính tần suất cao, nơi mà chi phí tính toán của phương pháp hoán vị (permutation test) truyền thống là rào cản lớn.
\end{itemize}

\section{Đánh giá SE-CDT: Phân loại drift không giám sát}
\label{sec:classification-eval}

Phần này đánh giá hiệu quả của \textbf{Classification Module} (SE-CDT). Khác với các phương pháp supervised yêu cầu labels, SE-CDT hoạt động hoàn toàn không giám sát bằng cách phân tích hình dạng tín hiệu drift magnitude $\sigma(t)$.

\subsection{Thiết lập thực nghiệm (Classification Setup)}

\textbf{Cấu hình (Code: \texttt{benchmark\_proper.py}):}
\begin{itemize}
	\item \textbf{Dữ liệu:} Dataset tổng hợp với độ dài $T = 8,000$ mẫu.
	\item \textbf{Kịch bản Drift:} Bao gồm đầy đủ 5 loại drift: Sudden, Gradual, Incremental, Recurrent (A-B-A), và Blip.
	\item \textbf{Số lượng test case:} 17 configurations $\times$ 10 runs = 170 kịch bản kiểm thử.
	\item \textbf{Tham số ShapeDD:} Window size $W=50$, Stride $s=10$.
	\item \textbf{Ground Truth:} Loại drift được gán nhãn thủ công tại các điểm thay đổi để tính Accuracy.
\end{itemize}

Để tối ưu hóa hiệu suất phân loại, trước khi đưa ra kết quả cuối cùng, luận văn tiến hành hai bước hiệu chỉnh quan trọng: (1) Lựa chọn biến thể MMD phù hợp cho module phân loại, và (2) Hiệu chỉnh ngưỡng phát hiện (Threshold Calibration).

\subsection{Lựa chọn biến thể MMD: Standard vs IDW-MMD}
\label{sec:mmd-variant-choice}

Trong quá trình phát triển SE-CDT, luận văn đã thử nghiệm cả hai biến thể MMD. Mặc dù IDW-MMD hoạt động tốt cho Detection (như đã thấy ở phần trước), kết quả thực nghiệm lại chỉ ra nó không phù hợp cho Classification.

\textbf{Kết quả so sánh:}
\begin{itemize}
	\item \textbf{IDW-MMD:} CAT Accuracy 20.0\%, bỏ lỡ \textit{tất cả} các điểm drift Gradual/Incremental (MDR = 1.0).
	\item \textbf{Standard MMD:} CAT Accuracy 85.8\%, phát hiện tốt cả 5 loại drift.
\end{itemize}

\textbf{Lý do:} IDW-MMD sử dụng trọng số nghịch biến với mật độ ($w_{i} \propto 1/\sqrt{d_i}$). Cơ chế này tập trung vào các điểm outlier vùng biên để bắt sudden drift, nhưng lại vô tình "lọc bỏ" các tín hiệu thay đổi nhỏ, đồng đều của gradual drift (vốn thường diễn ra trong vùng mật độ cao). Ngược lại, Standard MMD tính toán bình đẳng trên toàn bộ mẫu, do đó bảo toàn được cấu trúc của các tín hiệu drift diễn ra từ từ.
$\rightarrow$ \textbf{Quyết định thiết kế:} Hệ thống sử dụng mô hình lai: \textit{Detection Module} dùng IDW-MMD (tối ưu độ nhạy biên), còn \textit{Classification Module} dùng Standard MMD (giữ lại thông tin toàn cục).

\subsection{Calibration ngưỡng phát hiện}
\label{sec:secdt-threshold}

Việc lựa chọn ngưỡng ($\tau$) ảnh hưởng trực tiếp đến độ nhạy. Thông qua phân tích sơ bộ trên dữ liệu validation streaming:
\begin{itemize}
	\item \textbf{Ngưỡng mặc định ($\tau = 0.5$):} Quá cao (conservative), không phát hiện được drift nào trên dữ liệu streaming demo.
	\item \textbf{Ngưỡng hiệu chỉnh ($\tau = 0.015$):} Cân bằng tốt nhất. Ngưỡng này đủ thấp để bắt được các tín hiệu drift vừa phải (moderate drift) nhưng đủ cao để lọc bỏ nhiễu ngẫu nhiên.
\end{itemize}
Do đó, các kết quả phân loại dưới đây sử dụng $\tau = 0.015$.

\subsection{Kết quả phân loại}

Bảng~\ref{tab:se-cdt-results} trình bày kết quả phân loại sử dụng cấu hình đã chọn (Standard MMD, $\tau=0.015$).

\begin{table}[H]
	\centering
	\caption{Kết quả phân loại drift type của SE-CDT}
	\label{tab:se-cdt-results}
	\input{../../results/tables/table_se_cdt_aggregate.tex}
\end{table}

\textbf{Confusion Matrix Analysis:}

Để hiểu rõ hơn về lỗi phân loại, Hình~\ref{fig:confusion-5class} và Hình~\ref{fig:confusion-category} trình bày confusion matrices ở hai mức độ chi tiết.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.85\textwidth]{../../results/plots/confusion_matrix_se_cdt.png}
	\caption[Confusion Matrix - 5 Classes]{
		\textbf{Confusion Matrix cho 5 loại drift}: Sudden có recall cao nhất (82.4\%, 140/170 events), trong khi Incremental và Gradual thường bị nhầm lẫn do tín hiệu MMD tương tự nhau.
	}
	\label{fig:confusion-5class}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.85\textwidth]{../../results/plots/confusion_matrix_category.png}
	\caption[Confusion Matrix - Category Level]{
		\textbf{Confusion Matrix ở mức Category (TCD vs PCD)}: Cho thấy độ chính xác 81.2\%, với TCD recall = 90.4\% và PCD recall = 72.7\%.
	}
	\label{fig:confusion-category}
\end{figure}

\textbf{Phân tích:}
\begin{itemize}
	\item \textbf{Kết quả độ chính xác:} SE-CDT (Standard MMD) đạt độ chính xác nhóm (CAT) = \textbf{72.2\%} và độ chính xác subcategory (SUB) = \textbf{50.0\%}.
	\item \textbf{Event Detection Rate (EDR):} Đạt \textbf{94.4\%}, nghĩa là phát hiện phần lớn các drift. Đổi lại, số lượng báo động giả (FP) cao hơn so với IDW-MMD (\textbf{1394} vs 171), nhưng trong ngữ cảnh classification (sau khi detection module đã lọc), ưu tiên là không bỏ sót thông tin để phân loại đúng.
	\item \textbf{Hạn chế:} Hệ thống hiện tại xử lý Recurrent drift như chuỗi các sự kiện Sudden riêng lẻ (độ chính xác Recurrent = 0\%), chưa có cơ chế bộ nhớ dài hạn.
\end{itemize}

\subsection{Hiệu năng phân loại chi tiết}
\label{sec:secdt-detailed-performance}

Để đánh giá toàn diện khả năng của SE-CDT trong môi trường không giám sát, chúng tôi phân tích hiệu suất trên từng loại drift cụ thể. Bảng~\ref{tab:se-cdt-performance-summary} tóm tắt các chỉ số hiệu năng chính của phương pháp.

\begin{table}[H]
	\centering
	\caption{Tổng hợp hiệu năng phân loại của SE-CDT}
	\label{tab:se-cdt-performance-summary}
	\input{../../results/tables/table_se_cdt_performance_summary.tex}
\end{table}

Kết quả cho thấy SE-CDT đạt độ chính xác phân loại nhóm (Category Accuracy) là \textbf{72.2\%} và độ chính xác chi tiết (Subtype Accuracy) là \textbf{50.0\%}. Đặc biệt, khả năng phát hiện sự kiện (Event Detection Rate - EDR) đạt mức rất cao \textbf{94.4\%}, cho thấy phương pháp rất nhạy trong việc bắt được các thời điểm thay đổi.

\textbf{Phân tích theo từng loại drift:}

Bảng~\ref{tab:se-cdt-performance-by-type} trình bày độ chính xác chi tiết cho từng loại drift.

\begin{table}[H]
	\centering
	\caption{Độ chính xác phân loại theo từng loại drift}
	\label{tab:se-cdt-performance-by-type}
	\input{../../results/tables/table_se_cdt_performance_by_type.tex}
\end{table}

\textbf{Nhận xét chi tiết:}
\begin{itemize}
	\item \textbf{Sudden Drift (82.0\%):} Đây là điểm mạnh nhất của phương pháp. Tín hiệu MMD tạo ra đỉnh nhọn (peak) rõ ràng, giúp dễ dàng phân biệt với các loại khác.
	
	\item \textbf{Gradual Drift (55.0\%):} Khả năng phát hiện drift dần dần ở mức trung bình khá. Việc sử dụng Standard MMD giúp bảo toàn thông tin toàn cục tốt hơn so với IDW-MMD trong trường hợp này.
	
	\item \textbf{Incremental Drift (24.0\%):} Mặc dù thấp hơn so với Sudden và Gradual, kết quả này vẫn cho thấy khả năng nhận diện xu hướng thay đổi tuyến tính nhờ các đặc trưng temporal (LTS, MS). Tuy nhiên, sự nhầm lẫn với Gradual drift vẫn còn cao do tính chất tương đồng của tín hiệu.
	
	\item \textbf{Blip Drift (18.0\%):} Kết quả thấp cho thấy khó khăn trong việc phân biệt giữa nhiễu ngắn hạn và drift tạm thời (Blip) trong môi trường không giám sát hoàn toàn.
	
	\item \textbf{Recurrent Drift (0\%):} Hạn chế hiện tại của hệ thống là chưa có cơ chế bộ nhớ dài hạn (concept memory) để liên kết các trạng thái lặp lại, do đó Recurrent drift thường được xử lý như các sự kiện Sudden riêng lẻ.
\end{itemize}

\textbf{Hình dạng tín hiệu (Signal Shapes):}

Hình~\ref{fig:signal_sudden} và Hình~\ref{fig:signal_incremental} minh họa sự khác biệt trong hình dạng tín hiệu MMD giúp hệ thống phân loại.

\begin{figure}[H]
        \centering
        \includegraphics[width=0.95\textwidth]{../../results/plots/vis_repeated_sudden_SE.png}
        \caption[Signal Shape - Sudden Drift]{Tín hiệu SE-CDT cho Sudden drift: Peak nhọn, đối xứng, dễ phát hiện bằng height threshold.}
        \label{fig:signal_sudden}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.95\textwidth]{../../results/plots/vis_repeated_incremental_SE.png}
	\caption[Signal Shape - Incremental Drift]{Tín hiệu SE-CDT cho Incremental drift: Ramp tăng dần. Các predictions chưa hoàn hảo (xen kẽ Blip/Gradual/Incremental), phản ánh đúng độ chính xác subcategory 50\% trong Bảng~\ref{tab:se-cdt-results}.}
	\label{fig:signal_incremental}
\end{figure}

\section{Đánh giá khả năng thích ứng mô hình}
\label{sec:adaptation-eval}

Sau khi phát hiện drift, hệ thống kích hoạt quy trình thích ứng. Phần này đánh giá hiệu quả của chiến lược thích ứng theo loại drift (Type-Specific Adaptation) sử dụng chỉ số \textbf{Prequential Accuracy}.

\subsection{Thiết lập thực nghiệm (Adaptation Setup)}
Thực nghiệm đánh giá khả năng thích ứng (Code: \texttt{monitoring/evaluate\_prequential.py}) được thiết lập như sau:
\begin{itemize}
	\item \textbf{Môi trường:} Giả lập Streaming Loop (Prequential Evaluation).
	\item \textbf{Dữ liệu:} Luồng dữ liệu ngắn gọn $T = 5,000$ mẫu tập trung vào các sự kiện drift dày đặc.
	\item \textbf{Các loại drift thử nghiệm:} Sudden (Stepping & Alternating), Gradual, và Recurrent.
	\item \textbf{Cấu hình tham số:}
	\begin{itemize}
		\item SE-CDT threshold $\tau = 0.015$ (đã hiệu chỉnh).
		\item Window size $W = 250$.
		\item Classifier: RandomForest (n=10) hoặc Hoeffding Tree.
	\end{itemize}
	\item \textbf{Metric:} Prequential Accuracy (độ chính xác cuốn chiếu) để đo lường khả năng phục hồi tức thời.
\end{itemize}

\subsection{Phân biệt Real Drift và Virtual Drift trong thích ứng}
Như đã thảo luận ở Mục~\ref{sec:overview} và Mục~\ref{sec:detection-eval}, các phương pháp unsupervised như SE-CDT được thiết kế để phát hiện Real Drift (thay đổi $P(X)$) và bỏ qua Virtual Drift (chỉ đổi $P(Y|X)$). Do đó, các kết quả đánh giá thích ứng dưới đây tập trung vào các kịch bản Real Drift, nơi SE-CDT có thể phát huy tác dụng kích hoạt learning.

\subsection{Kết quả phục hồi (Recovery)}

Để khắc phục hạn chế của các bộ tạo dữ liệu Sudden Drift truyền thống (thường luân phiên giữa hai concept A $\to$ B $\to$ A, dẫn đến việc mô hình tĩnh có độ chính xác ảo ~75\%), luận văn bổ sung kịch bản \textbf{Stepping Drift}. Đây là dạng trôi dạt tích lũy (Cumulative Sudden Drift), nơi phân phối dữ liệu liên tục dịch chuyển ra xa trạng thái ban đầu ($P_0 \to P_1 \to P_2 \dots$), buộc mô hình phải học lại liên tục để duy trì hiệu suất.

Bảng~\ref{tab:prequential-results} tổng hợp kết quả Prequential Accuracy, trong đó kịch bản Stepping cho thấy rõ nhất hiệu quả của thích ứng.

\begin{table}[H]
	\centering
	\caption{Kết quả Prequential Accuracy theo loại drift (SE-CDT threshold = 0.015)}
	\label{tab:prequential-results}
	\begin{tabular}{|l|c|c|c|}
		\hline
		\textbf{Loại Drift} & \textbf{Type-Specific} & \textbf{No Adaptation} & \textbf{Improvement} \\
		\hline
		Stepping (Cumulative) & \textbf{79.03\%}       & 72.61\%                & \textbf{+6.42\%}     \\
		Gradual             & 80.80\%                & 79.02\%                & +1.78\%               \\
		Mixed (Combined)    & \textbf{85.16\%}       & 83.72\%                & +1.44\%               \\
		\hline
	\end{tabular}
\end{table}

\textbf{Kết quả:}
\begin{itemize}
	\item \textbf{Stepping Drift (+6.42\%):} Đây là kết quả quan trọng nhất. Trong khi mô hình tĩnh ("No Adaptation") bị suy giảm hiệu suất do dữ liệu ngày càng xa lạ, chiến lược Type-Specific Adaptation (kích hoạt bởi SE-CDT) đã giúp khôi phục độ chính xác gần 80\%. Điều này chứng minh giá trị thực tiễn của việc phát hiện và thích ứng kịp thời.
	\item \textbf{Mixed scenario (+1.44\%):} Trong môi trường hỗn hợp, hệ thống vẫn duy trì sự ổn định và cải thiện nhẹ so với baseline.
	\item \textbf{Gradual Drift:} Mức cải thiện khiêm tốn hơn do tính chất thay đổi chậm, khó xác định điểm cắt chính xác để retrain tối ưu.
\end{itemize}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.95\textwidth]{../../results/plots/fig_prequential_stepping.png}
	\caption[Prequential Accuracy trên Stepping Drift]{Prequential Accuracy trên Stepping Drift (Trôi dạt tích lũy). Đây là kịch bản thử thách nhất: đường màu đỏ (No Adaptation) suy giảm liên tục khi concept thay đổi (A$\to$B$\to$C), trong khi đường màu xanh (Type-Specific) duy trì hiệu suất cao nhờ cơ chế phát hiện và học lại kịp thời.}
	\label{fig:prequential_stepping}
\end{figure}

\textbf{So sánh với Sudden Drift truyền thống (Hình~\ref{fig:prequential_sudden}):}
Để đối chiếu, kết quả trên kịch bản Sudden Drift tiêu chuẩn (luân phiên A$\to$B$\to$A) cũng được trình bày. Trong trường hợp này, mô hình tĩnh ("No Adaptation") vẫn duy trì độ chính xác trung bình khá cao ($\sim 75\%$) do concept A lặp lại. Tuy nhiên, điều này chỉ che giấu vấn đề: mô hình thực tế đã thất bại hoàn toàn trong các giai đoạn concept B. Hệ thống đề xuất (Type-Specific) phục hồi nhanh hơn sau mỗi drift event, đạt accuracy trung bình 71.1\% (so với baseline 72.1\%), cho thấy trong kịch bản luân phiên đơn giản, adaptation chưa mang lại lợi thế rõ rệt do concept lặp lại.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.95\textwidth]{../../results/plots/fig_prequential_sudden.png}
	\caption[Prequential Accuracy trên Sudden Drift]{Prequential Accuracy trên Sudden Drift (Luân phiên). Mặc dù baseline (đỏ) có vẻ ổn định do sự lặp lại của concept, nhưng SE-CDT (xanh) vẫn cho thấy sự vượt trội về độ ổn định tuyệt đối (gần như 100\%).}
	\label{fig:prequential_sudden}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.95\textwidth]{../../results/plots/fig_prequential_gradual.png}
	\caption[Prequential Accuracy trên Gradual Drift]{
		Prequential Accuracy trên Gradual Drift: SE-CDT không phát hiện được drift trong kịch bản này (EDR = 0\%), do tín hiệu MMD của gradual drift quá yếu và kéo dài. Accuracy 74.7\% đạt được nhờ tính chất luân phiên của concept, không phải nhờ adaptation.
	}
	\label{fig:prequential_gradual}
\end{figure}

\section{Triển khai và Đánh giá trên Hệ thống Kafka Thực tế}
\label{sec:real-world-deployment}

Để kiểm chứng tính khả thi và hiệu quả của kiến trúc đề xuất trong môi trường production, chúng tôi đã triển khai hệ thống đầy đủ trên Docker với các thành phần: Redpanda (Kafka), SE-CDT Consumer, và Adaptation Manager.

\subsection{Kịch bản triển khai}
\begin{itemize}
	\item \textbf{Dữ liệu:} Luồng dữ liệu mô phỏng từ SEA dataset với Sudden Drift tại mẫu thứ 1500.
	\item \textbf{Cấu hình:} Window size = 250, Adaptation Delay = 50 mẫu (để thu thập dữ liệu post-drift).
	\item \textbf{Mục tiêu:} Xác nhận quy trình khép kín: Phát hiện Drift $\rightarrow$ Thích ứng đệm (Delayed Adaptation) $\rightarrow$ Cập nhật mô hình (Adaptor) $\rightarrow$ Reload mô hình (Consumer) $\rightarrow$ Phục hồi độ chính xác.
\end{itemize}

\subsection{Kết quả thực tế}

Hình~\ref{fig:kafka_real_results} trình bày Dashboard giám sát trực tiếp từ lần chạy triển khai:

\begin{figure}[H]
	\centering
	\includegraphics[width=1.0\textwidth]{image/kafka_results_real.png}
	\caption[Kết quả triển khai thực tế trên Kafka]{Dashboard giám sát hệ thống Kafka thực tế. (1) Dữ liệu stream với điểm drift tại mẫu 1500. (2) \textbf{Hiệu quả thích ứng:} Độ chính xác giảm xuống 0.59 tại điểm drift, nhưng nhanh chóng \textbf{phục hồi lên 0.93} sau khi mô hình được cập nhật tự động (vạch đỏ nét đứt "Model Reload"). (3) Tín hiệu SE-CDT phát hiện chính xác Sudden Drift. (4) Tài nguyên hệ thống (CPU/RAM) duy trì ổn định.}
	\label{fig:kafka_real_results}
\end{figure}

\textbf{Phân tích:}
\begin{itemize}
	\item \textbf{Độ trễ phát hiện:} Drift xảy ra tại mẫu 1500, hệ thống phát hiện tại mẫu 1476 (do cơ chế cửa sổ trượt nhìn thấy sự thay đổi phân phối sớm).
	\item \textbf{Quy trình Closed-Loop:} Log hệ thống xác nhận Consumer đã nhận tín hiệu "Model Updated" từ Adaptor và tải lại mô hình thành công tại mẫu 2277.
	\item \textbf{Hiệu quả phục hồi:} Độ chính xác (Accuracy) tăng vọt từ mức ngẫu nhiên (59\%) lên mức tối ưu (93\%) ngay sau khi mô hình mới được áp dụng, chứng minh tính đúng đắn của toàn bộ pipeline xử lý.
\end{itemize}

\section{Kết luận chương}

Các kết quả thực nghiệm dẫn đến những kết luận chính sau:
\begin{enumerate}
	\item \textbf{Detection:} Phương pháp đề xuất (ShapeDD-IDW) đạt sự cân bằng giữa hiệu suất và độ tin cậy với \textbf{0 False Positives}, đồng thời tăng tốc độ xử lý lên \textbf{20 lần} so với ShapeDD gốc.
	\item \textbf{Classification:} Module SE-CDT (sử dụng Standard MMD) cho thấy khả năng phân loại nhóm drift đạt CAT = 72.2\% và phân loại chi tiết SUB = 50.0\% mà không cần dán nhãn dữ liệu, với tỷ lệ phát hiện sự kiện (EDR) đạt 94.4\%.
	\item \textbf{Adaptation:} Việc tích hợp phát hiện và phân loại drift vào quy trình thích ứng giúp cải thiện độ chính xác đáng kể: tăng \textbf{+6.42\%} trong các kịch bản trôi dạt tích lũy (Stepping Drift) và duy trì sự ổn định (+1.44\%) trong môi trường hỗn hợp. Điều này khẳng định giá trị của việc "hiểu" loại drift thay vì chỉ phản ứng mù quáng.
\end{enumerate}

Kết quả này cho thấy tính khả thi của kiến trúc đề xuất cho các hệ thống giám sát luồng dữ liệu thời gian thực.
