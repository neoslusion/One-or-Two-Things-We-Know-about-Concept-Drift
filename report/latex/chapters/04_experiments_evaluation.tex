\chapter{Thực nghiệm và đánh giá}
\label{chap:experiments}

\section{Tổng quan thực nghiệm}

\subsection{Mục tiêu}
Chương này trình bày các kết quả thực nghiệm nhằm kiểm chứng hiệu quả của hệ thống đề xuất. Quá trình đánh giá được chia thành hai giai đoạn chính:
\begin{enumerate}
    \item \textbf{Đánh giá khả năng phát hiện Drift (Detection Benchmark):} So sánh hiệu suất của ShapeDD và các biến thể cải tiến (OW-MMD, MMD-Agg) với các phương pháp phổ biến (Baseline) trên các tập dữ liệu đa dạng.
    \item \textbf{Đánh giá khả năng thích ứng (Adaptation Evaluation):} Kiểm chứng hiệu quả của chiến lược cập nhật mô hình tự động thông qua chỉ số độ chính xác tích lũy (Prequential Accuracy).
\end{enumerate}

\subsection{Môi trường và Cấu hình}
Các thực nghiệm được tiến hành trên hệ thống có cấu hình: CPU 8-core, RAM 16GB, chạy trên nền tảng Docker container hóa để đảm bảo tính tái lập. Hệ thống streaming được giả lập sử dụng Apache Kafka.

\textbf{Cấu hình tham số chung:}
\begin{itemize}
    \item Kích thước luồng dữ liệu (Stream length): $10,000$ mẫu/dataset.
    \item Số lượng điểm drift: $10$ điểm/dataset (cách đều nhau).
    \item Độ trễ chấp nhận được (Acceptable delay): $\delta = 150$ mẫu.
    \item Số lần chạy lặp lại (Runs): $30$ lần với các random seed khác nhau để đảm bảo độ tin cậy thống kê ($\alpha = 0.05$).
\end{itemize}

\section{Tập dữ liệu thực nghiệm}

Để đảm bảo tính khách quan, nghiên cứu sử dụng bộ 7 tập dữ liệu bao gồm cả dữ liệu tổng hợp (synthetic) và thực tế (real-world), đại diện cho các loại drift và đặc tính dữ liệu khác nhau.

\subsection{Dữ liệu tổng hợp (Synthetic Datasets)}
Dữ liệu tổng hợp cho phép kiểm soát chính xác vị trí và loại drift (Ground Truth), là cơ sở để tính toán các chỉ số Precision, Recall và F1.

\begin{itemize}
    \item \textbf{SEA Concepts (Standard & Gradual):} Bộ dữ liệu kinh điển với 3 đặc trưng, drift xảy ra do thay đổi ngưỡng phân lớp. Biến thể \textit{sea\_gradual} mô phỏng sự thay đổi từ từ.
    \item \textbf{STAGGER Concepts:} Dữ liệu phân loại với các đặc trưng nhị phân, đại diện cho \textit{Sudden Drift} (thay đổi đột ngột về luật phân lớp).
    \item \textbf{Rotating Hyperplane:} Dữ liệu đa chiều (10 features) với ranh giới quyết định xoay dần theo thời gian, đại diện cho \textit{Incremental/Gradual Drift}.
    \item \textbf{RBF (Slow & Blips):} Dữ liệu được sinh từ các trọng tâm Gaussian di chuyển. \textit{Rbf\_slow} đại diện cho drift chậm, trong khi \textit{rbfblips} mô phỏng các thay đổi bất thường ngắn hạn (Blip).
\end{itemize}

\subsection{Dữ liệu thực tế (Real-world Datasets)}
\begin{itemize}
    \item \textbf{Electricity (Sorted):} Dữ liệu giá điện thị trường New South Wales (Úc). Để tạo ra các điểm drift rõ ràng phục vụ benchmark, dữ liệu được sắp xếp theo thời gian và đặc trưng nhu cầu (demand), tạo ra các thay đổi phân phối tự nhiên nhưng có thể kiểm chứng.
\end{itemize}

\section{Đánh giá phương pháp phát hiện Drift}

Phần này so sánh phương pháp đề xuất với các baseline phổ biến: KS-Test (thống kê), MMD (kernel-based), DAWIDD, và D3 (discriminative).

\subsection{Kết quả tổng hợp}

Bảng~\ref{tab:comprehensive_performance} tóm tắt hiệu suất trung bình của các phương pháp trên toàn bộ 7 tập dữ liệu qua 30 lần chạy.

% =============================================================================
% Bảng tổng hợp hiệu suất (Auto-generated)
% =============================================================================
\input{../../experiments/drift_detection_benchmark/publication_figures/table_I_comprehensive_performance.tex}

\textbf{Phân tích kết quả:}
\begin{itemize}
    \item \textbf{MMD\_OW đạt F1 cao nhất ($0.576 \pm 0.442$):} Phương pháp sử dụng trọng số tối ưu (Optimally-Weighted MMD) đạt kết quả tốt nhất về F1-score, cho thấy hiệu quả của kỹ thuật giảm phương sai.
    \item \textbf{ShapeDD\_OW\_MMD xếp hạng 2 (F1 = $0.562$):} Biến thể kết hợp OW-MMD với đặc trưng hình dạng (shape feature) cho kết quả tương đương MMD\_OW, đồng thời có throughput cao (46,773 samples/s).
    \item \textbf{D3 (Discriminative Drift Detector) xếp hạng 3 (F1 = $0.517$):} Kết quả này cao hơn dự kiến do trong bộ dữ liệu có các dataset với Real Drift (thay đổi $P(X)$). Tuy nhiên, D3 vẫn thất bại hoàn toàn trên các dataset Virtual Drift (xem mục~\ref{sec:d3_analysis}).
    \item \textbf{KS xếp hạng 8 (F1 = $0.299$):} Mặc dù có Recall cao nhất (0.775), KS tạo ra nhiều False Positives (9,397 FPs), dẫn đến Precision thấp (0.197) và F1-score thấp.
\end{itemize}

\subsection{Phân tích ý nghĩa thống kê}

Để khẳng định sự khác biệt về hiệu suất không phải do ngẫu nhiên, biểu đồ Critical Difference (CD) sử dụng kiểm định Friedman và Nemenyi post-hoc test được trình bày trong Hình~\ref{fig:critical_difference}.

\begin{figure}[h]
\centering
\includegraphics[width=0.9\textwidth]{../../experiments/drift_detection_benchmark/publication_figures/critical_difference_f1.pdf}
\caption{Biểu đồ Critical Difference (CD) với mức ý nghĩa $\alpha = 0.05$. Friedman test cho p-value = 0.8161 (không có sự khác biệt thống kê đáng kể giữa các phương pháp).}
\label{fig:critical_difference}
\end{figure}

Kết quả kiểm định Friedman (p = 0.8161) cho thấy \textbf{không có sự khác biệt thống kê đáng kể} giữa các phương pháp. Điều này ngụ ý rằng việc lựa chọn phương pháp nên dựa vào các tiêu chí khác như \textit{throughput}, \textit{Precision} (nếu cần giảm false alarm), hoặc \textit{Recall} (nếu cần phát hiện nhiều nhất có thể).

\subsection{Đánh giá chi tiết trên từng loại dữ liệu}

Hiệu suất của các phương pháp thay đổi tùy thuộc vào đặc tính của tập dữ liệu (Bảng\ref{tab:f1_by_dataset}).

% =============================================================================
% Bảng F1 theo Dataset (Auto-generated)
% =============================================================================
\input{../../experiments/drift_detection_benchmark/publication_figures/table_II_f1_by_dataset.tex}

\textbf{Quan sát chi tiết (tham khảo Bảng~\ref{tab:f1_by_dataset}):}
\begin{enumerate}
    \item \textbf{Synthetic datasets có drift rõ ràng (gaussian\_shift, gen\_random\_severe):}
    Các biến thể OW-MMD và ShapeDD hoạt động xuất sắc. Trên \textit{stagger}, ShapeDD\_OW\_MMD đạt F1 = 0.994 và ShapeDD\_MMDAgg đạt F1 = 1.000 (hoàn hảo). Điều này xác nhận lý thuyết \"hình dạng tam giác\" của ShapeDD hoạt động hiệu quả nhất với các thay đổi đột ngột.

    \item \textbf{Gradual/Incremental Drift (hyperplane, standard\_sea):}
    Tất cả các phương pháp đều gặp khó khăn (F1 $< 0.25$). Đây là hạn chế cố hữu của các phương pháp window-based: sự thay đổi phân phối bị \"pha loãng\" trong bộ đệm (buffer dilution), tín hiệu drift không tạo thành đỉnh nhọn rõ ràng.

    \item \textbf{Blip Drift (rbfblips):}
    D3, ShapeDD\_MMDAgg đạt F1 = 1.000; ShapeDD\_OW\_MMD đạt F1 = 0.920. Các phương pháp này phát hiện tốt các thay đổi ngắn hạn (blips) nhờ khả năng bắt tín hiệu nhanh.
\end{enumerate}

\subsection{Phân tích đặc biệt: Tại sao D3 thất bại?}
\label{sec:d3_analysis}

Mặc dù D3 (Discriminative Drift Detector) đạt F1 = 0.517 tổng thể (xếp hạng 3), phân tích chi tiết cho thấy hiệu suất rất không đồng đều giữa các dataset:

\begin{itemize}
    \item \textbf{Hoạt động tốt (F1 $> 0.9$):} Các dataset có \textit{Real Drift} (thay đổi $P(X)$) như \texttt{gaussian\_shift} (F1=0.998), \texttt{gen\_random\_severe} (F1=0.959), \texttt{rbfblips} (F1=1.000).
    \item \textbf{Thất bại hoàn toàn (F1 = 0):} Các dataset có \textit{Virtual Drift} (chỉ thay đổi $P(Y|X)$) như \texttt{hyperplane}, \texttt{standard\_sea}, \texttt{led\_abrupt}.
    \item \textbf{Cơ chế:} D3 huấn luyện một mô hình để phân biệt giữa dữ liệu cũ và mới. Nếu phân phối đầu vào $P(X)$ không đổi, bộ phân loại không thể phân biệt (AUC $\approx$ 0.5).
\end{itemize}

Kết quả này khẳng định rằng D3 chỉ hiệu quả khi có sự thay đổi trong phân phối đầu vào $P(X)$ (Real Drift/Covariate Shift).

\subsection{Đánh giá hiệu suất tính toán (Runtime & Throughput)}

Bảng\ref{tab:runtime_stats} so sánh thời gian xử lý trung bình và thông lượng (throughput) của các phương pháp.

\input{../../experiments/drift_detection_benchmark/publication_figures/table_III_runtime_stats.tex}

\textbf{Kết quả (tham khảo Bảng~\ref{tab:runtime_stats}):}
\begin{itemize}
    \item \textbf{MMD\_OW và ShapeDD\_OW\_MMD:} Nhanh nhất với throughput $\approx 47,000$ mẫu/giây. Việc sử dụng trọng số tối ưu giúp loại bỏ nhu cầu hoán vị (permutation) tốn kém.
    \item \textbf{ShapeDD gốc:} Tốc độ trung bình ($\sim 6,800$ mẫu/giây), bị giới hạn bởi bước kiểm định hoán vị.
    \item \textbf{DAWIDD:} Chậm nhất ($\sim 3,700$ mẫu/giây) do tính toán phức tạp.
    \item \textbf{Cải thiện:} OW-MMD variants nhanh hơn $\approx 7\times$ so với ShapeDD gốc.
\end{itemize}

\section{Đánh giá khả năng thích ứng mô hình}

Sau khi phát hiện drift, hệ thống kích hoạt quy trình thích ứng. Phần này đánh giá hiệu quả của chiến lược \textbf{"Full Model Reset"} đối với loại \textit{Sudden Drift}.

\subsection{Phương pháp đánh giá}
Sử dụng chỉ số \textbf{Prequential Accuracy} (độ chính xác dự báo trước - học sau) trên luồng dữ liệu 5,000 mẫu chứa 5 điểm sudden drift.

\subsection{Kết quả phục hồi (Recovery)}

Hình\ref{fig:prequential_accuracy} minh họa quá trình suy giảm và phục hồi độ chính xác của mô hình theo thời gian.

\begin{figure}[H]
\centering
\includegraphics[width=0.95\textwidth]{image/prequential_accuracy_sudden.png}
\caption{Độ chính xác Prequential theo thời gian. Đường màu xanh (Type-Specific/Simple Retrain) cho thấy độ chính xác phục hồi nhanh chóng sau mỗi điểm drift (ký hiệu tam giác đỏ), trong khi đường màu đỏ (No Adaptation) tiếp tục suy giảm.}
\label{fig:prequential_accuracy}
\end{figure}

\textbf{Số liệu chi tiết:}
\begin{itemize}
    \item \textbf{Không thích ứng (No Adaptation):} Độ chính xác giảm xuống dưới $60\%$ sau các đợt drift liên tiếp.
    \item \textbf{Có thích ứng (With Adaptation):}
        \begin{itemize}
            \item \textbf{Recovery Rate:} Trung bình $82.8\%$ (tức là mô hình phục hồi được hơn 80\% hiệu suất ban đầu ngay sau khi cập nhật).
            \item \textbf{Thời gian phục hồi:} Khoảng $50-100$ mẫu sau điểm drift.
            \item \textbf{Tổng thể:} Duy trì độ chính xác trung bình $>84\%$ trên toàn bộ luồng dữ liệu.
        \end{itemize}
\end{itemize}

Kết quả này chứng minh rằng việc kết hợp phát hiện drift nhanh (ShapeDD) với chiến lược cập nhật dứt khoát (Full Reset) là giải pháp hiệu quả để duy trì độ tin cậy của hệ thống trong môi trường biến động mạnh.

\section{Kết luận chương}

Các thực nghiệm trong chương này đã đưa ra những kết luận quan trọng:
\begin{enumerate}
    \item \textbf{Về phát hiện:} Phương pháp KS là tốt nhất về tổng thể (F1), nhưng ShapeDD và các biến thể MMD cung cấp độ chính xác (Precision) cao hơn, phù hợp cho các hệ thống yêu cầu giảm thiểu báo động giả.
    \item \textbf{Về tốc độ:} Biến thể OW-MMD giải quyết triệt để bài toán hiệu suất, cho phép xử lý dữ liệu luồng tốc độ cao.
    \item \textbf{Về thích ứng:} Hệ thống đã chứng minh khả năng tự động phát hiện và phục hồi sau drift, ngăn chặn sự suy giảm hiệu suất tích lũy.
\end{enumerate}

Những kết quả này là cơ sở vững chắc để khẳng định tính khả thi của mô hình đề xuất trong các ứng dụng thực tế.
