\chapter{Thực nghiệm và đánh giá}
\label{chap:experiments}

\section{Tổng quan thực nghiệm}

\subsection{Mục tiêu}
Chương này trình bày các kết quả thực nghiệm nhằm kiểm chứng hiệu quả của hệ thống đề xuất. Quá trình đánh giá được chia thành hai giai đoạn chính:
\begin{enumerate}
    \item \textbf{Đánh giá khả năng phát hiện Drift (Detection Benchmark):} So sánh hiệu suất của ShapeDD và các biến thể cải tiến (OW-MMD, SNR-Adaptive) với các phương pháp phổ biến (Baseline) trên các tập dữ liệu đa dạng.
    \item \textbf{Đánh giá khả năng thích ứng (Adaptation Evaluation):} Kiểm chứng hiệu quả của chiến lược cập nhật mô hình tự động thông qua chỉ số độ chính xác tích lũy (Prequential Accuracy).
\end{enumerate}

\subsection{Môi trường và Cấu hình}
Các thực nghiệm được tiến hành trên hệ thống có cấu hình: CPU 8-core, RAM 16GB, chạy trên nền tảng Docker container hóa để đảm bảo tính tái lập. Hệ thống streaming được giả lập sử dụng Apache Kafka.

\textbf{Cấu hình tham số chung:}
\begin{itemize}
    \item Kích thước luồng dữ liệu (Stream length): $10,000$ mẫu/dataset.
    \item Số lượng điểm drift: $10$ điểm/dataset (cách đều nhau).
    \item Độ trễ chấp nhận được (Acceptable delay): $\delta = 150$ mẫu.
    \item Số lần chạy lặp lại (Runs): $30$ lần với các random seed khác nhau để đảm bảo độ tin cậy thống kê ($\alpha = 0.05$).
\end{itemize}

\section{Tập dữ liệu thực nghiệm}

Để đảm bảo tính khách quan, nghiên cứu sử dụng bộ 7 tập dữ liệu bao gồm cả dữ liệu tổng hợp (synthetic) và thực tế (real-world), đại diện cho các loại drift và đặc tính dữ liệu khác nhau.

\subsection{Dữ liệu tổng hợp (Synthetic Datasets)}
Dữ liệu tổng hợp cho phép kiểm soát chính xác vị trí và loại drift (Ground Truth), là cơ sở để tính toán các chỉ số Precision, Recall và F1.

\begin{itemize}
    \item \textbf{SEA Concepts (Standard & Gradual):} Bộ dữ liệu kinh điển với 3 đặc trưng, drift xảy ra do thay đổi ngưỡng phân lớp. Biến thể \textit{sea\_gradual} mô phỏng sự thay đổi từ từ.
    \item \textbf{STAGGER Concepts:} Dữ liệu phân loại với các đặc trưng nhị phân, đại diện cho \textit{Sudden Drift} (thay đổi đột ngột về luật phân lớp).
    \item \textbf{Rotating Hyperplane:} Dữ liệu đa chiều (10 features) với ranh giới quyết định xoay dần theo thời gian, đại diện cho \textit{Incremental/Gradual Drift}.
    \item \textbf{RBF (Slow & Blips):} Dữ liệu được sinh từ các trọng tâm Gaussian di chuyển. \textit{Rbf\_slow} đại diện cho drift chậm, trong khi \textit{rbfblips} mô phỏng các thay đổi bất thường ngắn hạn (Blip).
\end{itemize}

\subsection{Dữ liệu thực tế (Real-world Datasets)}
\begin{itemize}
    \item \textbf{Electricity (Sorted):} Dữ liệu giá điện thị trường New South Wales (Úc). Để tạo ra các điểm drift rõ ràng phục vụ benchmark, dữ liệu được sắp xếp theo thời gian và đặc trưng nhu cầu (demand), tạo ra các thay đổi phân phối tự nhiên nhưng có thể kiểm chứng.
\end{itemize}

\section{Đánh giá phương pháp phát hiện Drift}

Phần này so sánh phương pháp đề xuất với các baseline phổ biến: KS-Test (thống kê), MMD (kernel-based), DAWIDD, và D3 (discriminative).

\subsection{Kết quả tổng hợp}

Bảng\ref{tab:comprehensive_performance} tóm tắt hiệu suất trung bình của các phương pháp trên toàn bộ 7 tập dữ liệu qua 30 lần chạy.

% =============================================================================
% Bảng tổng hợp hiệu suất (Auto-generated)
% =============================================================================
\input{../../experiments/drift_detection_benchmark/publication_figures/table_I_comprehensive_performance.tex}

\textbf{Phân tích kết quả:}
\begin{itemize}
    \item \textbf{KS (Kolmogorov-Smirnov) đạt F1 cao nhất ($0.686 \pm 0.179$):} Đây là phương pháp thống kê phi tham số, hoạt động ổn định trên nhiều loại dữ liệu nhờ khả năng phát hiện thay đổi ở từng đặc trưng riêng lẻ.
    \item \textbf{MMD-based methods (MMD, ShapeDD, ShapeDD\_OW\_MMD):} Các phương pháp này thể hiện \textbf{Precision cao} (từ $0.786$ đến $0.847$), nghĩa là rất ít báo động giả (False Positives). Tuy nhiên, độ nhạy (Recall) thấp hơn KS, cho thấy xu hướng \"bảo thủ\" (conservative) -- chỉ báo động khi drift thực sự rõ ràng.
    \item \textbf{ShapeDD\_SNR\_Adaptive:} Đạt MTTD (Mean Time To Detection) thấp nhất ($24$ mẫu), phản ứng nhanh nhất với các thay đổi. Tuy nhiên, F1-score thấp ($0.236$) do trade-off giữa tốc độ và độ nhạy trong cơ chế adaptive.
    \item \textbf{D3 (Discriminative Drift Detector):} Đạt F1 xấp xỉ 0. Nguyên nhân sẽ được phân tích chi tiết ở mục\ref{sec:d3_analysis}.
\end{itemize}

\subsection{Phân tích ý nghĩa thống kê}

Để khẳng định sự khác biệt về hiệu suất không phải do ngẫu nhiên, biểu đồ Critical Difference (CD) sử dụng kiểm định Friedman và Nemenyi post-hoc test được trình bày trong Hình\ref{fig:critical_difference}.

\begin{figure}[h]
\centering
\includegraphics[width=0.9\textwidth]{../../experiments/drift_detection_benchmark/publication_figures/critical_difference_f1.pdf}
\caption{Biểu đồ Critical Difference (CD) với mức ý nghĩa $\alpha = 0.05$. Các phương pháp được nối bởi thanh ngang không có sự khác biệt thống kê đáng kể.}
\label{fig:critical_difference}
\end{figure}

Kết quả kiểm định cho thấy KS xếp hạng 1 (tốt nhất), nhưng không có sự khác biệt thống kê đáng kể so với nhóm MMD và DAWIDD (nằm trong cùng khoảng CD). Điều này khẳng định các phương pháp dựa trên phân phối (Distribution-based) như MMD và KS vẫn là lựa chọn tin cậy nhất cho bài toán unsupervised drift detection.

\subsection{Đánh giá chi tiết trên từng loại dữ liệu}

Hiệu suất của các phương pháp thay đổi tùy thuộc vào đặc tính của tập dữ liệu (Bảng\ref{tab:f1_by_dataset}).

% =============================================================================
% Bảng F1 theo Dataset (Auto-generated)
% =============================================================================
\input{../../experiments/drift_detection_benchmark/publication_figures/table_II_f1_by_dataset.tex}

\textbf{Quan sát chi tiết:}
\begin{enumerate}
    \item \textbf{Sudden Drift (STAGGER, LED):}
    ShapeDD và các biến thể hoạt động tốt trên các tập dữ liệu có sự thay đổi khái niệm rõ ràng (concept shift). Đặc biệt trên STAGGER, ShapeDD\_OW\_MMD đạt F1 = 0.779, tiệm cận với KS. Điều này xác nhận lý thuyết về \"hình dạng tam giác\" (triangle shape) của ShapeDD hoạt động hiệu quả nhất với các thay đổi đột ngột.

    \item \textbf{Gradual Drift (Hyperplane, Sea\_gradual):}
    Các phương pháp cửa sổ trượt (window-based) như ShapeDD gặp khó khăn với drift diễn ra từ từ. Do sự thay đổi phân phối bị \"pha loãng\" trong bộ đệm (buffer dilution), tín hiệu drift không tạo thành đỉnh nhọn rõ ràng, dẫn đến Recall thấp. KS test vượt trội ở đây nhờ khả năng so sánh phân phối tích lũy mà không phụ thuộc vào hình dạng tín hiệu theo thời gian.

    \item \textbf{Real-world (Electricity):}
    Trên dữ liệu thực tế, ShapeDD (F1 = 0.600) vượt qua KS (F1 = 0.417). Điều này cho thấy tính bền vững (robustness) của phương pháp ShapeDD trước nhiễu thực tế, nơi KS test có thể quá nhạy cảm và tạo ra nhiều báo động giả.
\end{enumerate}

\subsection{Phân tích đặc biệt: Tại sao D3 thất bại?}
\label{sec:d3_analysis}

Một phát hiện quan trọng từ thực nghiệm là phương pháp D3 (Discriminative Drift Detector) đạt F1 = 0.000 trên hầu hết các tập dữ liệu tổng hợp. Đây không phải là lỗi cài đặt mà là một \textbf{hạn chế phương pháp luận} của các bộ phát hiện dựa trên bộ phân loại (discriminative classifiers).

\begin{itemize}
    \item \textbf{Cơ chế:} D3 huấn luyện một mô hình để phân biệt giữa dữ liệu cũ và dữ liệu mới. Nếu mô hình phân biệt tốt (AUC cao), nó kết luận có drift.
    \item \textbf{Vấn đề:} Các tập dữ liệu như SEA hay Hyperplane chứa \textit{Virtual Drift} hoặc thay đổi về $P(Y|X)$ (xác suất hậu nghiệm) trong khi $P(X)$ (phân phối đầu vào) giữ nguyên (thường là phân phối đều Uniform).
    \item \textbf{Hệ quả:} Vì phân phối đầu vào $P(X)$ không đổi, bộ phân loại của D3 không thể phân biệt được dữ liệu cũ và mới (AUC $\approx$ 0.5), dẫn đến không phát hiện được drift.
\end{itemize}

Kết quả này khẳng định rằng các phương pháp unsupervised (như D3, KS, MMD) chỉ thực sự hiệu quả khi có sự thay đổi trong phân phối đầu vào $P(X)$ (Real Drift/Covariate Shift).

\subsection{Đánh giá hiệu suất tính toán (Runtime & Throughput)}

Bảng\ref{tab:runtime_stats} so sánh thời gian xử lý trung bình và thông lượng (throughput) của các phương pháp.

\input{../../experiments/drift_detection_benchmark/publication_figures/table_III_runtime_stats.tex}

\textbf{Kết quả:}
\begin{itemize}
    \item \textbf{MMD\_OW (Optimally-Weighted):} Là phương pháp nhanh nhất với throughput $>27,000$ mẫu/giây. Việc sử dụng trọng số tối ưu giúp loại bỏ nhu cầu hoán vị (permutation) tốn kém.
    \item \textbf{ShapeDD gốc:} Có tốc độ trung bình ($\sim 3,600$ mẫu/giây), bị giới hạn bởi bước kiểm định hoán vị.
    \item \textbf{ShapeDD\_OW\_MMD:} Mặc dù chậm hơn MMD\_OW đơn lẻ do phải tính toán thêm đặc trưng hình dạng, nhưng vẫn cải thiện đáng kể so với ShapeDD gốc trong các tình huống kích thước cửa sổ lớn.
\end{itemize}

\section{Đánh giá khả năng thích ứng mô hình}

Sau khi phát hiện drift, hệ thống kích hoạt quy trình thích ứng. Phần này đánh giá hiệu quả của chiến lược \textbf{"Full Model Reset"} đối với loại \textit{Sudden Drift}.

\subsection{Phương pháp đánh giá}
Sử dụng chỉ số \textbf{Prequential Accuracy} (độ chính xác dự báo trước - học sau) trên luồng dữ liệu 5,000 mẫu chứa 5 điểm sudden drift.

\subsection{Kết quả phục hồi (Recovery)}

Hình\ref{fig:prequential_accuracy} minh họa quá trình suy giảm và phục hồi độ chính xác của mô hình theo thời gian.

\begin{figure}[H]
\centering
\includegraphics[width=0.95\textwidth]{image/prequential_accuracy_sudden.png}
\caption{Độ chính xác Prequential theo thời gian. Đường màu xanh (Type-Specific/Simple Retrain) cho thấy độ chính xác phục hồi nhanh chóng sau mỗi điểm drift (ký hiệu tam giác đỏ), trong khi đường màu đỏ (No Adaptation) tiếp tục suy giảm.}
\label{fig:prequential_accuracy}
\end{figure}

\textbf{Số liệu chi tiết:}
\begin{itemize}
    \item \textbf{Không thích ứng (No Adaptation):} Độ chính xác giảm xuống dưới $60\%$ sau các đợt drift liên tiếp.
    \item \textbf{Có thích ứng (With Adaptation):}
        \begin{itemize}
            \item \textbf{Recovery Rate:} Trung bình $82.8\%$ (tức là mô hình phục hồi được hơn 80\% hiệu suất ban đầu ngay sau khi cập nhật).
            \item \textbf{Thời gian phục hồi:} Khoảng $50-100$ mẫu sau điểm drift.
            \item \textbf{Tổng thể:} Duy trì độ chính xác trung bình $>84\%$ trên toàn bộ luồng dữ liệu.
        \end{itemize}
\end{itemize}

Kết quả này chứng minh rằng việc kết hợp phát hiện drift nhanh (ShapeDD) với chiến lược cập nhật dứt khoát (Full Reset) là giải pháp hiệu quả để duy trì độ tin cậy của hệ thống trong môi trường biến động mạnh.

\section{Kết luận chương}

Các thực nghiệm trong chương này đã đưa ra những kết luận quan trọng:
\begin{enumerate}
    \item \textbf{Về phát hiện:} Phương pháp KS là tốt nhất về tổng thể (F1), nhưng ShapeDD và các biến thể MMD cung cấp độ chính xác (Precision) cao hơn, phù hợp cho các hệ thống yêu cầu giảm thiểu báo động giả.
    \item \textbf{Về tốc độ:} Biến thể OW-MMD giải quyết triệt để bài toán hiệu suất, cho phép xử lý dữ liệu luồng tốc độ cao.
    \item \textbf{Về thích ứng:} Hệ thống đã chứng minh khả năng tự động phát hiện và phục hồi sau drift, ngăn chặn sự suy giảm hiệu suất tích lũy.
\end{enumerate}

Những kết quả này là cơ sở vững chắc để khẳng định tính khả thi của mô hình đề xuất trong các ứng dụng thực tế.