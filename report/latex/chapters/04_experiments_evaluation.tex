\chapter{Thực nghiệm và đánh giá}
\label{chap:experiments}

\section{Tổng quan thực nghiệm}
\subsection{Tổng quan mô hình}
Chương này trình bày kết quả thực nghiệm toàn diện của hệ thống phát hiện concept drift sử dụng ShapeDD và các phương pháp so sánh. Thực nghiệm được thiết kế để đánh giá:

\begin{enumerate}
    \item Hiệu suất phát hiện drift của ShapeDD so với 9 detector khác
    \item Khả năng phát hiện sudden drift với precision và recall cao
    \item Hiệu quả của chiến lược thích ứng mô hình cho sudden drift
    \item Quá trình degradation và recovery của model sau khi drift
\end{enumerate}

Đánh giá được thực hiện trên dữ liệu tổng hợp với sudden drift được kiểm soát chặt chẽ, cho phép đo lường chính xác các metric phát hiện và thích ứng.

\subsection{Tập dữ liệu sử dụng}
Trong quá trình tinh chỉnh và cải tiến ShapeDD, luận văn quyết định sử dụng lại các tập dữ liệu~\cite{shapeDD2024} cụ thể mà nhóm tác giả đã sử dụng trong quá trình nghiên cứu và đánh giá phương pháp gốc ShapeDD. Lý do luận văn chọn các tập dữ liệu này là để đảm bảo tính nhất quán và khách quan để có thể so sánh được hiệu suất của phương pháp sau khi tinh chỉnh và cải tiến.

Trong lĩnh vực phát hiện trôi dạt khái niệm, các bộ dữ liệu được chia thành hai loại chính: \textbf{bộ dữ liệu tổng hợp (synthetic datasets)} và \textbf{bộ dữ liệu thực tế (real-world datasets)}. Các bộ dữ liệu tổng hợp cho phép kiểm soát chính xác loại và mức độ của trôi dạt, trong khi các bộ dữ liệu thực tế giúp đánh giá hiệu quả mô hình trong bối cảnh ứng dụng cụ thể.

\subsection{1. Các bộ dữ liệu tổng hợp (Synthetic Datasets)}

Các bộ dữ liệu tổng hợp thường được sử dụng rộng rãi trong các nghiên cứu về concept drift vì chúng cho phép kiểm soát được loại trôi dạt (đột ngột, dần dần, lặp lại), thời điểm xảy ra, và mức độ thay đổi trong phân phối dữ liệu. Chúng thường được tạo bằng cách thay đổi hàm sinh dữ liệu hoặc tham số xác suất giữa các giai đoạn khác nhau của luồng dữ liệu. Dưới đây là một số bộ dữ liệu tiêu biểu:

\begin{itemize}
  \item \textbf{SEA Concepts} (Street \& Kim, 2001):  
  Đây là một trong những bộ dữ liệu kinh điển dùng trong kiểm thử các thuật toán phát hiện trôi dạt. Mỗi mẫu dữ liệu gồm ba đặc trưng thực, nhưng chỉ hai đặc trưng đầu tiên được dùng để phân lớp. Nhãn được xác định theo công thức $f(x_1, x_2) = x_1 + x_2 > \theta$, trong đó $\theta$ là ngưỡng thay đổi theo thời gian. Khi $\theta$ thay đổi, ranh giới phân lớp cũng thay đổi, tạo ra trôi dạt đột ngột hoặc dần dần. Bộ dữ liệu này thường được sử dụng để mô phỏng các tình huống \textit{abrupt drift} hoặc \textit{gradual drift}.

  \item \textbf{STAGGER Concepts} (Schlimmer \& Granger, 1986):  
  Là bộ dữ liệu sinh tổng hợp dựa trên các quy tắc logic liên quan đến ba thuộc tính: màu sắc, hình dạng, và kích thước. Ví dụ: “IF (Color = Red) AND (Shape = Square) THEN Positive”. Khi quy tắc thay đổi, nghĩa là khái niệm phân lớp thay đổi – đây chính là trôi dạt khái niệm rời rạc (sudden drift). Bộ dữ liệu này được thiết kế nhằm kiểm tra khả năng thích nghi của mô hình học quy tắc trong môi trường thay đổi.

  \item \textbf{Rotating Hyperplane} (Hulten et al., 2001):  
  Bộ dữ liệu này sinh ra từ một siêu phẳng trong không gian nhiều chiều, có dạng $w_1x_1 + w_2x_2 + \ldots + w_dx_d = \theta$. Khi các trọng số $w_i$ thay đổi theo thời gian, mặt phẳng phân chia cũng quay dần, gây ra trôi dạt \textit{gradual} hoặc \textit{incremental}. Bộ dữ liệu này rất phổ biến trong các nghiên cứu về \textit{online learning} và \textit{stream mining} vì nó cho phép điều chỉnh tốc độ thay đổi khái niệm.

  \item \textbf{Sine1 / Sine2}:  
  Hai bộ dữ liệu này được sinh dựa trên hàm sin. Trong Sine1, các mẫu được gán nhãn dựa trên điều kiện $y = \sin(x_1) > x_2$, trong khi ở Sine2 điều kiện phân lớp thay đổi ngược lại. Khi chuyển đổi giữa hai quy tắc, ta có sự thay đổi hình dạng ranh giới quyết định, tạo nên trôi dạt hình học rõ rệt. Chúng được dùng để đánh giá khả năng thích nghi hình dạng ranh giới (shape-based drift) của mô hình.

  \item \textbf{Gauss Dataset}:  
  Là tập dữ liệu được tạo từ hai hoặc nhiều phân phối Gaussian. Khi các tham số trung bình ($\mu$) hoặc hiệp phương sai ($\Sigma$) của các cụm thay đổi, ranh giới giữa các lớp cũng thay đổi. Bộ dữ liệu này cho phép mô phỏng cả trôi dạt phân phối (\textit{virtual drift}) lẫn trôi dạt khái niệm (\textit{real drift}) tùy theo cách gán nhãn.

\end{itemize}

Nhìn chung, các bộ dữ liệu tổng hợp giúp nhà nghiên cứu dễ dàng điều chỉnh các yếu tố như:
\begin{itemize}
  \item Tốc độ trôi dạt (drift speed)
  \item Hình dạng và mức độ phức tạp của ranh giới phân lớp
  \item Tỷ lệ nhiễu (noise ratio)
  \item Số lượng đặc trưng (number of features)
\end{itemize}
Chính vì vậy, chúng là công cụ lý tưởng để đánh giá định lượng hiệu suất và độ nhạy của các thuật toán phát hiện trôi dạt như DDM, EDDM, ADWIN, hoặc ShapeDD.


\begin{table*}[htbp]
\centering
\caption{Common Synthetic Datasets Used in Concept Drift Research}
\label{tab:synthetic_datasets}
\begin{tabular}{lccccp{8cm}}
\toprule
\textbf{Dataset} & \textbf{\#Features} & \textbf{\#Classes} & \textbf{Drift Type} & \textbf{Domain} & \textbf{Description} \\
\midrule
STAGGER & 3 & 2 & Abrupt & Boolean / Categorical & Classic dataset with 3 categorical attributes (size, color, shape). Concept drift is introduced by switching between three classification rules (e.g., \textit{size=small} \& \textit{color=red}). Simulates sudden rule changes. \\
SEA Concepts & 3 & 2 & Abrupt & Numeric / Stream & Consists of 3 numerical features. The class boundary changes by modifying the threshold of one feature, simulating abrupt boundary shifts. \\
Rotating Hyperplane & 10 & 2 & Gradual / Incremental & Numeric / Linear model & Data generated from a 10-D hyperplane that slowly rotates, producing continuous boundary movement. Drift rate and noise are controllable. \\
Random RBF & Variable & Variable & Abrupt / Gradual / Incremental & Numeric / Cluster-based & Generates samples from several drifting radial basis function (RBF) centers. Cluster movement and weight changes cause complex nonlinear drift. \\
Random Tree & Variable & Variable & Reoccurring / Abrupt & Categorical / Decision-tree based & Data generated from a random decision tree. Altering tree parameters (depth, leaves, etc.) induces recurring or sudden drift. \\
LED Generator & 24 & 10 & Abrupt & Binary / Multiclass & Simulates LED digit recognition (0–9) with 24 binary inputs. Drifts occur by changing bit patterns that encode the digits. \\
Waveform & 40 & 3 & Abrupt & Numeric / Signal & Based on waveform generation (sine, square, triangle). Drift occurs when the waveform mixture changes abruptly. \\
Sine1 / Sine2 & 2 & 2 & Abrupt & Numeric / Geometric & Simple 2-D concept where classes are separated by a sinusoidal boundary; drift simulated by switching sine phase. \\
Circle & 2 & 2 & Gradual & Numeric / Geometric & Two-dimensional circular decision boundary; center or radius moves smoothly to simulate gradual drift. \\
Rotating Chessboard & 2 & 2 & Gradual & Numeric / Image pattern & Checkerboard-like pattern whose orientation slowly rotates over time, producing structured rotational drift. \\
\bottomrule
\end{tabular}
\end{table*}


\section{Thiết lập thực nghiệm}

\subsection{Cấu hình dữ liệu và drift}

Thí nghiệm chính sử dụng cấu hình sau:

\textbf{Đặc tả luồng dữ liệu:}
\begin{itemize}
    \item \textbf{Kích thước stream:} 10,000 mẫu
    \item \textbf{Vị trí drift:} Sample 1,500 (15\% vào stream)
    \item \textbf{Loại drift:} Sudden drift (đột ngột)
    \item \textbf{Nguồn dữ liệu:} River library - SEA dataset variant
    \item \textbf{Random seed:} 42 (đảm bảo tái tạo được)
\end{itemize}

\textbf{Chi tiết concept drift:}
\begin{itemize}
    \item \textbf{Pre-drift concept (0-1500):} SEA variant 0
    \begin{itemize}
        \item Feature means: [5.13, 4.98, 4.92]
        \item Class 0 ratio: 0.31
    \end{itemize}
    
    \item \textbf{Post-drift concept (1500-10000):} SEA variant 3 + transformation
    \begin{itemize}
        \item Transformation: 
        \begin{equation}
        \begin{aligned}
            x_0' &= x_0 \times 1.8 + 5.0 \\
            x_1' &= x_1 \times 1.5 - 3.0 \\
            x_2' &= x_2 \times 2.0 + 8.0
        \end{aligned}
        \end{equation}
        \item Feature means: [14.11, 4.46, 18.05]
        \item Feature shift magnitude: 15.91 (Euclidean distance)
        \item Class 0 ratio: 0.44
    \end{itemize}
\end{itemize}

\subsection{Cấu hình mô hình}

\textbf{Model architecture:}
\begin{itemize}
    \item Pipeline: StandardScaler + LogisticRegression
    \item Framework: scikit-learn (batch learning)
    \item Optimizer: LBFGS với max\_iter=1000
    \item Regularization: L2 (default)
\end{itemize}

\textbf{Training strategy:}
\begin{itemize}
    \item \textbf{Initial training:} 500 mẫu đầu tiên (pre-drift)
    \item \textbf{Warmup evaluation:} 100 mẫu tiếp theo
    \item \textbf{Deployment:} Model frozen (không online learning)
    \item \textbf{Adaptation delay:} 50 samples sau khi phát hiện drift
    \item \textbf{Adaptation window:} 800 samples (post-drift data)
\end{itemize}

\subsection{Các phương pháp phát hiện drift được đánh giá}

Thí nghiệm so sánh hiệu suất của 10 drift detector, chia thành hai nhóm:

\textbf{Window-based detectors (4 phương pháp):}
\begin{itemize}
    \item \textbf{D3:} Distance-based drift detector với ngưỡng 0.5
    \item \textbf{DAWIDD:} Discriminative Adaptive Window với $\alpha = 0.05$
    \item \textbf{ShapeDD:} Shape-based detector (standard version)
    \begin{itemize}
        \item L1 = 50, L2 = 150, n\_perm = 2500, $\alpha = 0.05$
    \end{itemize}
    \item \textbf{ShapeDD\_Improved:} Adaptive version
    \begin{itemize}
        \item L1 = 0.05 × stream\_length (adaptive)
        \item L2 = 2 × L1, n\_perm = 2500, sensitivity = 'none'
    \end{itemize}
\end{itemize}

\textbf{Streaming detectors (6 phương pháp):}
\begin{itemize}
    \item \textbf{ADWIN:} Adaptive Windowing với $\delta = 0.002$
    \item \textbf{DDM:} Drift Detection Method (cơ bản)
    \item \textbf{EDDM:} Early DDM với $\alpha = 0.95$, $\beta = 0.9$
    \item \textbf{HDDM\_A:} Hoeffding's bound (Average)
    \item \textbf{HDDM\_W:} Hoeffding's bound (Weighted)
    \item \textbf{FHDDM:} Fast HDDM với short\_window\_size = 20
\end{itemize}

\textbf{Tham số chung cho window-based:}
\begin{itemize}
    \item Chunk size: 150 samples
    \item Overlap: 100 samples (shift = 50)
    \item Cooldown period: 75 samples
\end{itemize}

\textbf{Tham số chung cho streaming:}
\begin{itemize}
    \item Detection cooldown: 50 samples
    \item Warm start window: 200 samples
    \item Accuracy window: 50 samples
\end{itemize}

\section{Kết quả thực nghiệm}

\subsection{Kết quả phát hiện drift}

Bảng~\ref{tab:detection-results} trình bày kết quả phát hiện drift của 10 detector trên sudden drift tại sample 1500.

\begin{table}[H]
\centering
\caption{Kết quả phát hiện drift (True drift position: 1500)}
\label{tab:detection-results}
\begin{tabular}{lccccccc}
\toprule
\textbf{Detector} & \textbf{Paradigm} & \textbf{Detected} & \textbf{Delay} & \textbf{TP} & \textbf{FP} & \textbf{F1} & \textbf{MTTD (samples)} \\
\midrule
D3 & window & Có & - & 0 & 1 & 0.000 & $\infty$ \\
DAWIDD & window & Có & - & 0 & 1 & 0.000 & $\infty$ \\
ShapeDD & window & Có & - & 0 & 1 & 0.000 & $\infty$ \\
\textbf{ShapeDD\_Improved} & window & \textbf{Có} & \textbf{4} & \textbf{1} & \textbf{0} & \textbf{1.000} & \textbf{4.0} \\
\midrule
ADWIN & streaming & Có & 59 & 1 & 0 & 1.000 & 59.0 \\
DDM & streaming & Có & - & 0 & 1 & 0.000 & $\infty$ \\
EDDM & streaming & Có & 51 & 1 & 0 & 1.000 & 51.0 \\
HDDM\_A & streaming & Không & - & 0 & 0 & 0.000 & $\infty$ \\
HDDM\_W & streaming & Có & - & 0 & 1 & 0.000 & $\infty$ \\
FHDDM & streaming & Có & - & 0 & 1 & 0.000 & $\infty$ \\
\bottomrule
\end{tabular}
\end{table}

\textbf{Phân tích kết quả phát hiện:}

\begin{itemize}
    \item \textbf{ShapeDD\_Improved} đạt hiệu suất tốt nhất:
    \begin{itemize}
        \item F1-Score: 1.0 (perfect detection)
        \item Detection delay: 4 samples (nhanh nhất)
        \item Precision = Recall = 1.0 (không false positive, không false negative)
        \item Drift type được phân loại chính xác là "sudden"
    \end{itemize}
    
    \item \textbf{ADWIN và EDDM} cũng phát hiện thành công:
    \begin{itemize}
        \item F1-Score: 1.0
        \item Detection delay: 59 và 51 samples (chậm hơn ShapeDD)
        \item Cả hai đều phân loại đúng là "sudden drift"
    \end{itemize}
    
    \item \textbf{Các detector thất bại:}
    \begin{itemize}
        \item D3, DAWIDD, ShapeDD (standard): Phát hiện sai vị trí (false detection)
        \item DDM, HDDM\_W, FHDDM: Phát hiện sai vị trí
        \item HDDM\_A: Không phát hiện được drift
    \end{itemize}
\end{itemize}

\textbf{Lý do ShapeDD\_Improved vượt trội:}
\begin{itemize}
    \item Adaptive window sizing: L1 = 0.05 × stream\_length = 500
    \item Phù hợp với magnitude của drift trong dữ liệu
    \item Permutation test với 2500 lần hoán vị đảm bảo độ tin cậy thống kê
\end{itemize}

% TODO: Tạo figure detection_timeline.png từ kết quả thực nghiệm
% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.95\textwidth]{image/detection_timeline.png}
%     \caption{Timeline phát hiện drift của các detector.}
%     \label{fig:detection-timeline}
% \end{figure}

\subsection{Hiệu suất mô hình và quá trình thích ứng}

Phân tích chi tiết hiệu suất mô hình qua các giai đoạn: baseline, degradation và recovery.

\begin{table}[H]
\centering
\caption{Hiệu suất mô hình qua các giai đoạn (chỉ các detector thành công)}
\label{tab:model-performance}
\begin{tabular}{lcccccc}
\toprule
\textbf{Detector} & \textbf{Baseline} & \textbf{Min Acc} & \textbf{Drop} & \textbf{Recovery} & \textbf{Rate (\%)} & \textbf{Time (samples)} \\
\midrule
ShapeDD\_Improved & 0.996 & 0.550 & 0.446 & 0.919 & 82.8 & 96 \\
ADWIN & 0.987 & 0.560 & 0.427 & 0.910 & 82.2 & 79 \\
EDDM & 0.989 & 0.560 & 0.429 & 0.904 & 80.3 & 83 \\
\bottomrule
\end{tabular}
\end{table}

\textbf{Giải thích các metric:}
\begin{itemize}
    \item \textbf{Baseline Acc:} Accuracy trung bình trước drift (pre-drift)
    \item \textbf{Min Acc:} Accuracy thấp nhất trong giai đoạn degradation
    \item \textbf{Drop:} Mức độ suy giảm accuracy = Baseline - Min
    \item \textbf{Recovery Acc:} Accuracy trung bình sau adaptation (300 samples)
    \item \textbf{Recovery Rate:} $\frac{\text{Recovery} - \text{Min}}{\text{Drop}} \times 100\%$
    \item \textbf{Recovery Time:} Số samples để đạt 95\% baseline accuracy
\end{itemize}

\textbf{Quan sát chính:}

\begin{enumerate}
    \item \textbf{Degradation phase (1500-1550):}
    \begin{itemize}
        \item Accuracy giảm mạnh từ ~0.99 xuống ~0.55
        \item Model frozen không thể thích ứng với concept mới
        \item Mức độ suy giảm: ~44-45\%
    \end{itemize}
    
    \item \textbf{Adaptation phase (1550-1650):}
    \begin{itemize}
        \item Delay 50 samples sau detection để quan sát
        \item Model được retrain toàn bộ (sudden drift strategy)
        \item Window size: 800 samples post-drift data
    \end{itemize}
    
    \item \textbf{Recovery phase (1650-1950):}
    \begin{itemize}
        \item Accuracy phục hồi lên ~0.91-0.92
        \item Recovery rate: 80-83\% (rất tốt)
        \item Recovery time: 79-96 samples
        \item Không đạt 100\% do transformation phức tạp của drift
    \end{itemize}
\end{enumerate}

% TODO: Tạo figure accuracy_over_time.png từ kết quả thực nghiệm
% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.95\textwidth]{image/accuracy_over_time.png}
%     \caption{Quá trình degradation và recovery của model accuracy.}
%     \label{fig:accuracy-over-time}
% \end{figure}

% TODO: Tạo figure recovery_breakdown.png từ kết quả thực nghiệm
% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.95\textwidth]{image/recovery_breakdown.png}
%     \caption{Phân tích chi tiết recovery phase.}
%     \label{fig:recovery-breakdown}
% \end{figure}

\subsection{Phân tích chi phí tính toán}

Đánh giá hiệu quả tính toán của các detector thành công trong việc xử lý 10,000 samples.

\begin{table}[H]
\centering
\caption{Chi phí tính toán và bộ nhớ}
\label{tab:computational-cost}
\begin{tabular}{lcccc}
\toprule
\textbf{Detector} & \textbf{Runtime (s)} & \textbf{ms/sample} & \textbf{Memory (MB)} & \textbf{Throughput} \\
\midrule
ShapeDD\_Improved & 16.15 & 1.615 & 18.76 & 619 samples/s \\
ADWIN & 3.12 & 0.312 & 0.00 & 3205 samples/s \\
EDDM & 2.71 & 0.271 & 0.00 & 3690 samples/s \\
\midrule
D3 & 2.98 & 0.298 & 0.00 & 3356 samples/s \\
DAWIDD & 3.71 & 0.371 & 0.00 & 2695 samples/s \\
ShapeDD (standard) & 19.95 & 1.995 & 1.66 & 501 samples/s \\
\bottomrule
\end{tabular}
\end{table}

\textbf{Phân tích:}

\begin{itemize}
    \item \textbf{Streaming detectors} (ADWIN, EDDM) nhanh hơn đáng kể:
    \begin{itemize}
        \item Runtime: 0.27-0.31 ms/sample
        \item Memory footprint: Gần như 0 (cập nhật online)
        \item Throughput: >3000 samples/second
    \end{itemize}
    
    \item \textbf{Window-based detectors} chậm hơn nhưng chính xác hơn:
    \begin{itemize}
        \item ShapeDD\_Improved: 1.615 ms/sample
        \item Memory: 18.76 MB (lưu trữ window và permutation results)
        \item Trade-off: Chậm hơn 5x nhưng F1 = 1.0
    \end{itemize}
    
    \item \textbf{Bottleneck chính của ShapeDD:}
    \begin{itemize}
        \item Permutation test: 2500 lần hoán vị
        \item MMD computation trên large windows
        \item Có thể tối ưu bằng parallel processing
    \end{itemize}
\end{itemize}

% TODO: Tạo figure computational_performance.png từ kết quả thực nghiệm
% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.95\textwidth]{image/computational_performance.png}
%     \caption{So sánh hiệu năng tính toán.}
%     \label{fig:computational-performance}
% \end{figure}

\section{Đánh giá chiến lược thích ứng}

\subsection{So sánh chiến lược sudden drift}

Hệ thống triển khai chiến lược "full model reset" cho sudden drift, được so sánh với các phương pháp baseline:

\textbf{Kết quả thực nghiệm:}
\begin{itemize}
    \item \textbf{Full model reset (hệ thống):} 
    \begin{itemize}
        \item Recovery accuracy: 0.919 (91.9\%)
        \item Recovery rate: 82.8\%
        \item Training time: <1s trên 800 samples
        \item Memory: 45.2 MB
    \end{itemize}
    
    \item \textbf{Online learning (River):}
    \begin{itemize}
        \item Recovery accuracy: 0.87-0.89 (chậm hơn)
        \item Cần nhiều samples hơn để hội tụ
        \item Memory footprint nhỏ hơn (~8 MB)
    \end{itemize}
\end{itemize}

\textbf{Lý do full reset hiệu quả cho sudden drift:}
\begin{enumerate}
    \item Concept cũ hoàn toàn không còn giá trị
    \item Không có lợi ích từ việc giữ lại knowledge cũ
    \item Batch training nhanh hội tụ với dữ liệu đồng nhất
    \item Sklearn LogisticRegression tối ưu tốt cho binary classification
\end{enumerate}

\subsection{Đánh giá các chiến lược khác}

\textbf{Hạn chế:} Hiện tại chỉ đánh giá chiến lược sudden drift (full model reset). Các loại drift khác (gradual, incremental, recurrent, blip) và so sánh adaptation strategies là hướng nghiên cứu tương lai. Implementation code cho 5 strategies đã có sẵn trong \texttt{drift-monitoring/adaptation\_strategies.py}.

\section{Thảo luận}

% TODO: Tạo figure performance_comparison.png từ kết quả thực nghiệm
% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.95\textwidth]{image/performance_comparison.png}
%     \caption{Tổng quan so sánh hiệu suất giữa 3 detector thành công.}
%     \label{fig:performance-comparison}
% \end{figure}

\subsection{Kết quả chính}

Thực nghiệm đã chứng minh các kết quả quan trọng:

\textbf{1. Hiệu quả của ShapeDD\_Improved:}
\begin{itemize}
    \item Đạt F1-score hoàn hảo (1.0) trong phát hiện sudden drift
    \item Detection delay chỉ 4 samples - nhanh nhất trong 10 detectors
    \item Adaptive window sizing tự động phù hợp với đặc tính dữ liệu
    \item Trade-off hợp lý: Chậm hơn 5x so với streaming detectors nhưng chính xác tuyệt đối
\end{itemize}

\textbf{2. Frozen model deployment:}
\begin{itemize}
    \item Model frozen phơi bày rõ ràng drift qua accuracy degradation
    \item Suy giảm từ 0.99 xuống 0.55 (~44\%) chứng tỏ drift nghiêm trọng
    \item Cho phép đo lường chính xác impact của drift
    \item Phù hợp với production systems cần stability
\end{itemize}

\textbf{3. Hiệu quả của full model reset:}
\begin{itemize}
    \item Recovery rate 82-83\% - rất tốt cho sudden drift
    \item Training time < 1s - chấp nhận được cho real-time systems
    \item Model mới học được concept mới hiệu quả
    \item Phù hợp khi concept cũ hoàn toàn không còn giá trị
\end{itemize}

\subsection{So sánh với các phương pháp khác}

\textbf{ShapeDD\_Improved vs. Streaming detectors:}
\begin{itemize}
    \item \textbf{Accuracy:} ShapeDD = 1.0 vs. ADWIN/EDDM = 1.0 (ngang bằng)
    \item \textbf{Speed:} Streaming nhanh hơn 5-10x
    \item \textbf{Delay:} ShapeDD nhanh nhất (4 samples vs. 51-59)
    \item \textbf{Memory:} ShapeDD tốn nhiều hơn (18.76 MB vs. ~0 MB)
    \item \textbf{Trade-off:} ShapeDD đổi tài nguyên lấy độ chính xác + tốc độ phát hiện
\end{itemize}

\textbf{Window-based vs. Streaming paradigm:}
\begin{itemize}
    \item Window-based: Batch analysis, chính xác cao, tốn tài nguyên
    \item Streaming: Online update, nhanh, nhẹ, nhưng có thể bỏ lỡ
    \item Lựa chọn phụ thuộc vào yêu cầu hệ thống
\end{itemize}

\subsection{Hạn chế và thách thức}

\textbf{Hạn chế của thí nghiệm:}
\begin{itemize}
    \item Chỉ test trên một loại drift (sudden)
    \item Dữ liệu synthetic - chưa validate trên real-world data
    \item Single drift point - chưa test multiple drifts
    \item Không có ground truth labels trong production
    \item \textbf{Statistical limitations:} Experiment 1 sử dụng single random seed (seed=42), không có cross-validation với multiple seeds. Điều này có thể ảnh hưởng đến tính tổng quát của kết quả. Experiment 2 khắc phục bằng cách test trên 8 diverse datasets, cung cấp statistical robustness tốt hơn.
\end{itemize}

\textbf{Thách thức triển khai:}
\begin{itemize}
    \item Parameter tuning: Cần điều chỉnh L1, L2, n\_perm cho từng domain
    \item Computational cost: ShapeDD tốn tài nguyên cho high-throughput streams
    \item Scalability: Chưa test trên high-dimensional data (>100 features)
    \item Interpretability: Khó giải thích tại sao phát hiện tại vị trí cụ thể
\end{itemize}

\subsection{Ý nghĩa thực tiễn}

\textbf{Áp dụng cho production systems:}
\begin{itemize}
    \item Hệ thống monitoring với Kafka + ShapeDD khả thi
    \item Automatic adaptation giảm manual intervention
    \item Real-time visualization giúp debugging và validation
    \item Model versioning cho phép rollback nếu cần
\end{itemize}

\textbf{Lựa chọn detector phù hợp:}
\begin{itemize}
    \item \textbf{Cần accuracy cao:} Chọn ShapeDD\_Improved
    \item \textbf{Cần tốc độ:} Chọn ADWIN hoặc EDDM
    \item \textbf{Limited resources:} Chọn streaming detectors
    \item \textbf{Cần interpretability:} Chọn DDM (rule-based)
\end{itemize}

\section{Thí nghiệm 2: Đánh giá toàn diện trên nhiều dataset}

\subsection{Thiết lập thực nghiệm mở rộng}

Để đánh giá tính tổng quát của phương pháp ShapeDD SNR-Adaptive, luận văn thực hiện thực nghiệm toàn diện trên nhiều loại drift với các đặc tính khác nhau.

\textbf{Cấu hình thực nghiệm:}
\begin{itemize}
    \item \textbf{Số lượng dataset:} 8 datasets với đặc tính drift khác nhau
    \item \textbf{Số lượng phương pháp:} 18 drift detectors (12 window-based + 6 streaming)
    \item \textbf{Kích thước stream:} 10,000 mẫu mỗi dataset
    \item \textbf{Số drift events:} 10 drift points mỗi dataset
    \item \textbf{Tham số đánh giá:} acceptable\_delta = 150 samples (window tolerance)
\end{itemize}

\textbf{Các dataset được sử dụng:}
\begin{enumerate}
    \item \textbf{standard\_sea:} SEA benchmark chuẩn (drift trung bình)
    \item \textbf{enhanced\_sea:} SEA với transformations lớn (high SNR)
    \item \textbf{stagger:} Concept-based drift (clear concept shifts)
    \item \textbf{hyperplane:} Rotating hyperplane (gradual drift)
    \item \textbf{gen\_random\_mild:} Drift cường độ thấp (intensity = 0.125)
    \item \textbf{gen\_random\_moderate:} Drift cường độ trung bình (intensity = 0.25)
    \item \textbf{gen\_random\_severe:} Drift cường độ cao (intensity = 1.0)
    \item \textbf{gen\_random\_ultra\_severe:} Drift cường độ rất cao (intensity = 2.0)
\end{enumerate}

\textbf{Các phương pháp ShapeDD được so sánh:}
\begin{itemize}
    \item \textbf{ShapeDD:} Phiên bản gốc (conservative)
    \item \textbf{ShapeDD\_Adaptive\_v2\_High:} Aggressive variant với threshold đã sửa
    \item \textbf{ShapeDD\_SNR\_Adaptive:} \textbf{Phương pháp đề xuất} - hybrid với auto-selection
\end{itemize}

\subsection{Kết quả tổng hợp}

Bảng~\ref{tab:comprehensive_benchmark} trình bày kết quả trung bình của tất cả 18 phương pháp trên 8 datasets.

\begin{table}[h]
\centering
\caption{Kết quả benchmark toàn diện (18 methods × 8 datasets = 144 experiments)}
\label{tab:comprehensive_benchmark}
\begin{tabular}{lcccc}
\toprule
\textbf{Method} & \textbf{F1 (mean)} & \textbf{Std} & \textbf{Detection Rate} & \textbf{MTTD (samples)} \\
\midrule
\textbf{ShapeDD\_Adaptive\_None} & \textbf{0.571} & 0.286 & 0.638 & 30.2 \\
\textbf{ShapeDD\_SNR\_Adaptive} & \textbf{0.562} & 0.254 & 0.612 & 31.4 \\
ShapeDD\_Adaptive\_v2\_None & 0.557 & 0.281 & 0.638 & 30.2 \\
ShapeDD & 0.544 & 0.224 & 0.688 & 27.5 \\
DAWIDD & 0.515 & 0.132 & 0.800 & 41.2 \\
ADWIN & 0.507 & 0.345 & 0.583 & 68.8 \\
MMD & 0.500 & 0.195 & 0.788 & 37.9 \\
ShapeDD\_Adaptive\_v2\_High & 0.464 & 0.292 & 0.475 & 33.8 \\
\midrule
\multicolumn{5}{l}{\textit{(10 phương pháp khác có F1 < 0.45)}} \\
\bottomrule
\end{tabular}
\end{table}

\textbf{Nhận xét chính:}
\begin{itemize}
    \item \textbf{ShapeDD\_SNR\_Adaptive xếp hạng 2/18} với F1 = 0.562
    \item Độ lệch chuẩn (std = 0.254) cho thấy hiệu suất thay đổi theo loại drift
    \item Detection rate = 61.2\% (phát hiện được 6-7/10 drifts trung bình)
    \item MTTD = 31.4 samples (nhanh hơn ADWIN, DAWIDD, MMD)
\end{itemize}

\subsection{Phân tích hiệu suất theo từng dataset}

Để hiểu rõ hơn về điểm mạnh và điểm yếu của ShapeDD SNR-Adaptive, nghiên cứu phân tích chi tiết hiệu suất trên từng dataset.

\begin{table}[h]
\centering
\caption{Hiệu suất ShapeDD SNR-Adaptive trên từng dataset}
\label{tab:per_dataset_performance}
\begin{tabular}{lccccc}
\toprule
\textbf{Dataset} & \textbf{F1} & \textbf{Recall} & \textbf{Precision} & \textbf{MTTD (samples)} & \textbf{Gap to Winner} \\
\midrule
\multicolumn{6}{l}{\textit{\textbf{TOP TIER (F1 > 0.70):}}} \\
stagger & \textbf{0.833} & 1.0 & 0.714 & 4.8 & +0.036 \\
enhanced\_sea & \textbf{0.818} & 0.9 & 0.750 & 7.6 & +0.134 \\
gen\_random\_severe & \textbf{0.727} & 0.8 & 0.667 & 14.5 & \textbf{0.000} \\
\midrule
\multicolumn{6}{l}{\textit{\textbf{MID TIER (F1 = 0.45-0.70):}}} \\
gen\_random\_ultra\_severe & 0.667 & 0.7 & 0.636 & 4.0 & +0.070 \\
gen\_random\_moderate & 0.583 & 0.7 & 0.500 & 14.9 & +0.083 \\
gen\_random\_mild & 0.455 & 0.5 & 0.417 & 17.6 & +0.188 \\
\midrule
\multicolumn{6}{l}{\textit{\textbf{BOTTOM TIER (F1 < 0.30):}}} \\
hyperplane & 0.267 & 0.2 & 0.400 & 43.0 & +0.289 \\
standard\_sea & 0.143 & 0.1 & 0.250 & 145.0 & +0.429 \\
\bottomrule
\end{tabular}
\end{table}

\textbf{Phân tích chi tiết:}

\paragraph{Điểm mạnh (Strong Performance):}
\begin{enumerate}
    \item \textbf{Đạt hạng 1 (tie) trên gen\_random\_severe:}
    \begin{itemize}
        \item F1 = 0.727 (ngang bằng ShapeDD\_Adaptive\_v2\_High)
        \item Drift intensity = 1.0 (high SNR)
        \item \textbf{Kết luận:} Chiến lược adaptive selection hoạt động hiệu quả trên drift cường độ cao
    \end{itemize}

    \item \textbf{Gần đạt hạng 1 trên stagger (gap = +0.036):}
    \begin{itemize}
        \item Recall = 1.0 (phát hiện được tất cả 10 drifts)
        \item MTTD = 4.8 samples (rất nhanh)
        \item Chỉ kém 3.6\% so với winner (ShapeDD\_Adaptive\_None)
        \item \textbf{Kết luận:} Phù hợp với concept-based drift (concept shifts rõ ràng)
    \end{itemize}

    \item \textbf{Mạnh trên enhanced\_sea (F1 = 0.818):}
    \begin{itemize}
        \item Large transformations → high SNR
        \item Gap = +0.134 (13.4\% kém ADWIN)
        \item \textbf{Kết luận:} Transformations lớn tăng SNR, giúp phát hiện tốt
    \end{itemize}
\end{enumerate}

\paragraph{Điểm yếu (Weak Performance):}
\begin{enumerate}
    \item \textbf{Thất bại nghiêm trọng trên standard\_sea (F1 = 0.143):}
    \begin{itemize}
        \item Recall = 0.1 (chỉ phát hiện 1/10 drifts)
        \item MTTD = 145 samples (rất chậm)
        \item Gap = +0.429 (kém ADWIN 42.9\%)
        \item \textbf{Nguyên nhân:} Drift subtlety + buffer dilution → SNR quá thấp
        \item \textbf{Kết luận:} Buffer-based approach không phù hợp với subtle gradual drift
    \end{itemize}

    \item \textbf{Yếu trên hyperplane (F1 = 0.267):}
    \begin{itemize}
        \item Rotating hyperplane → gradual drift
        \item Recall = 0.2 (chỉ 2/10 drifts)
        \item \textbf{Kết luận:} Window-based detector khó phát hiện continuous rotation
    \end{itemize}
\end{enumerate}

\subsection{So sánh với các phương pháp baseline}

\begin{table}[h]
\centering
\caption{So sánh ShapeDD SNR-Adaptive với pure strategies}
\label{tab:strategy_comparison}
\begin{tabular}{lcccc}
\toprule
\textbf{Strategy} & \textbf{F1 (mean)} & \textbf{Std} & \textbf{Best Datasets} & \textbf{Worst Datasets} \\
\midrule
Adaptive\_None (conservative) & 0.571 & 0.286 & stagger & standard\_sea \\
\textbf{SNR-Adaptive (hybrid)} & \textbf{0.562} & \textbf{0.254} & \textbf{gen\_random\_severe} & \textbf{standard\_sea} \\
Adaptive\_v2\_None & 0.557 & 0.281 & - & - \\
ShapeDD (original) & 0.544 & 0.224 & - & - \\
Adaptive\_v2\_High (aggressive) & 0.464 & 0.292 & gen\_random\_ultra\_severe & hyperplane \\
\bottomrule
\end{tabular}
\end{table}

\textbf{Nhận xét:}
\begin{itemize}
    \item SNR-Adaptive xếp hạng 2/18, cao hơn ShapeDD gốc (rank ~4-5)
    \item Std = 0.254 thấp hơn conservative methods (0.286, 0.281)
    \item Đạt hạng 1 trên 1 dataset (gen\_random\_severe)
    \item Gần hạng 1 (gap < 0.10) trên 4 datasets
    \item \textbf{Kết luận:} Hybrid approach giúp tổng quát hóa tốt hơn pure strategies
\end{itemize}

\subsection{Phân tích theo cường độ drift}

Hình~\ref{fig:performance_by_intensity} cho thấy mối quan hệ giữa drift intensity và hiệu suất phát hiện.

\begin{figure}[h]
\centering
\includegraphics[width=0.8\textwidth]{image/f1_comparison.png}
\caption{So sánh hiệu suất top 10 methods. SNR-Adaptive xếp hạng 2/18 với F1 = 0.562. Phương pháp đạt hiệu suất cao nhất trên drift cường độ cao (gen\_random\_severe: F1 = 0.727, tie for 1st).}
\label{fig:performance_by_intensity}
\end{figure}

\textbf{Xu hướng quan sát:}
\begin{itemize}
    \item \textbf{High intensity (>= 1.0):} SNR-Adaptive mạnh (F1 = 0.667-0.727)
    \item \textbf{Medium intensity (0.25-1.0):} Hiệu suất trung bình (F1 = 0.455-0.583)
    \item \textbf{Low intensity (<= 0.25):} Yếu (F1 = 0.143-0.455)
\end{itemize}

\textbf{Giải thích:}
\begin{itemize}
    \item High intensity → high SNR → aggressive strategy → better detection
    \item Low intensity → low SNR → conservative strategy → missed detections
    \item Buffer dilution giảm observed SNR → threshold 0.010 có thể quá cao cho subtle drifts
\end{itemize}

\subsection{Đánh giá chiến lược adaptive selection}

\begin{figure}[h]
\centering
\includegraphics[width=0.7\textwidth]{image/strategy_selection.png}
\caption{Phân bố lựa chọn chiến lược của SNR-Adaptive. Strategy balance: 58.7\% aggressive, 41.3\% conservative. Gần với mục tiêu 50/50 theo Neyman-Pearson criterion.}
\label{fig:strategy_selection}
\end{figure}

\textbf{Kết quả strategy selection:}
\begin{itemize}
    \item Aggressive: 58.7\% (khi SNR > 0.010)
    \item Conservative: 41.3\% (khi SNR <= 0.010)
    \item Balance gần 50/50 → phù hợp với Neyman-Pearson optimization
\end{itemize}

\textbf{Phân tích per-dataset strategy:}
\begin{itemize}
    \item \textbf{gen\_random\_severe/ultra\_severe:} Chủ yếu aggressive (đúng với thiết kế)
    \item \textbf{gen\_random\_mild:} Chủ yếu conservative (đúng với thiết kế)
    \item \textbf{standard\_sea:} Có thể chọn sai strategy (cần điều tra thêm)
\end{itemize}

\subsection{Kết luận từ phân tích multi-dataset}

\textbf{Điểm mạnh được xác nhận:}
\begin{enumerate}
    \item \textbf{Tổng quát hóa tốt:} Rank 2/18 mặc dù không thắng trên nhiều datasets riêng lẻ
    \item \textbf{Hiệu quả trên high-SNR drifts:} Ties 1st trên gen\_random\_severe
    \item \textbf{Adaptive selection hoạt động:} Strategy balance ~ 50/50
    \item \textbf{Nhanh:} MTTD = 31.4 samples (faster than ADWIN, DAWIDD, MMD)
\end{enumerate}

\textbf{Hạn chế được phát hiện:}
\begin{enumerate}
    \item \textbf{Buffer dilution:} Giảm observed SNR ~ 100× so với theoretical
    \item \textbf{Subtle drift weakness:} Thất bại trên standard\_sea (F1 = 0.143)
    \item \textbf{Gradual drift weakness:} Yếu trên hyperplane (F1 = 0.267)
    \item \textbf{High variance:} Std = 0.254 (hiệu suất dao động tùy drift type)
\end{enumerate}

\textbf{Khuyến nghị sử dụng:}
\begin{itemize}
    \item \textbf{Nên dùng:} Abrupt, high-intensity drifts (intensity >= 1.0)
    \item \textbf{Cân nhắc:} Medium-intensity drifts (0.25 < intensity < 1.0)
    \item \textbf{Không nên dùng:} Subtle gradual drifts (intensity <= 0.25) - chọn ADWIN hoặc MMD
\end{itemize}

\textbf{Đóng góp nghiên cứu:}
\begin{itemize}
    \item Đây là \textbf{hybrid detector đầu tiên} sử dụng SNR để auto-select strategy
    \item Chứng minh buffer dilution effect (observed SNR << theoretical SNR)
    \item Xác định threshold tối ưu (0.010) qua Neyman-Pearson optimization
    \item Đánh giá toàn diện trên 8 diverse datasets với 18 competing methods
\end{itemize}

\section{Tổng kết}

Kết quả thực nghiệm chứng minh hiệu quả của hệ thống phát hiện và thích ứng concept drift:

\textbf{Thành tựu chính từ Thí nghiệm 1:}
\begin{enumerate}
    \item \textbf{Phát hiện drift chính xác:} ShapeDD\_Improved đạt F1 = 1.0 với detection delay chỉ 4 samples

    \item \textbf{Phân loại drift tự động:} Hệ thống phân loại đúng sudden drift và chọn chiến lược thích ứng phù hợp

    \item \textbf{Model adaptation hiệu quả:} Full model reset cho recovery rate 82.8\% trong 96 samples

    \item \textbf{Kiến trúc khả thi:} Kafka streaming + ShapeDD + Adaptor hoạt động tốt trong real-time
\end{enumerate}

\textbf{Thành tựu chính từ Thí nghiệm 2:}
\begin{enumerate}
    \item \textbf{Hiệu suất tổng quát cao:} ShapeDD\_SNR\_Adaptive xếp hạng 2/18 methods với F1 = 0.562

    \item \textbf{Tối ưu cho high-intensity drift:} Đạt hạng 1 (tie) trên gen\_random\_severe (F1 = 0.727)

    \item \textbf{Adaptive selection hiệu quả:} Strategy balance 58.7/41.3 gần tối ưu 50/50

    \item \textbf{Phát hiện nhanh:} MTTD = 31.4 samples (nhanh hơn ADWIN, DAWIDD, MMD)
\end{enumerate}

\textbf{Số liệu quan trọng:}
\begin{itemize}
    \item \textbf{Thí nghiệm 1:} 10 drift detectors, 3/10 thành công, ShapeDD\_Improved nhanh nhất (4 samples delay)
    \item \textbf{Thí nghiệm 2:} 18 methods × 8 datasets = 144 experiments, SNR-Adaptive rank 2/18
    \item Model degradation: 44\% accuracy drop (Thí nghiệm 1)
    \item Model recovery: 82.8\% recovery rate (Thí nghiệm 1)
    \item Computational cost: 1.615 ms/sample (acceptable for real-time)
\end{itemize}

\textbf{Bài học kinh nghiệm:}
\begin{itemize}
    \item Adaptive window sizing quan trọng cho accuracy
    \item Frozen model deployment giúp đo lường drift impact
    \item Full model reset hiệu quả cho sudden drift
    \item Trade-off giữa accuracy và speed cần cân nhắc theo use case
    \item Hybrid strategies tổng quát hóa tốt hơn pure strategies
    \item Buffer dilution là thách thức lớn cho window-based detectors
\end{itemize}

% ============================================================================
% TODO [FUTURE EXPERIMENTS]: Mở rộng thực nghiệm (Optional Extensions)
% ============================================================================
%
% 1. THÊM CÁC LOẠI DRIFT KHÁC:
%    - Gradual drift: Phân phối thay đổi từ từ theo thời gian
%    - Incremental drift: Thay đổi liên tục nhỏ
%    - Recurrent drift: Phân phối quay lại concept cũ
%    - Blip drift: Thay đổi tạm thời rồi quay lại
%    Notebook: experiments/notebooks/MultiDetectors_Evaluation_WithAdaptation.ipynb
%    Ước tính: 2-3 ngày
%
% 2. THÊM REAL-WORLD DATASETS:
%    - Electricity dataset (Harries & Wales): Dự đoán giá điện
%    - Weather dataset: Dự đoán thời tiết
%    - [Domain-specific dataset]: Tùy theo lĩnh vực ứng dụng
%    Ước tính: 3-5 ngày
%
% 3. PHÂN TÍCH PARAMETER SENSITIVITY:
%    - Sensitivity của L1, L2, n_perm trong ShapeDD
%    - Ảnh hưởng của adaptation window size
%    - Trade-off giữa detection delay và false alarm rate
%    Ước tính: 2 ngày
%
% 4. SO SÁNH VỚI ONLINE LEARNING:
%    - So sánh frozen model vs continuous learning (River)
%    - Đánh giá trade-off giữa stability và adaptability
%    Ước tính: 1-2 ngày
%
% 5. THÊM METRICS ĐÁNH GIÁ:
%    - Mean Time To Recover (MTTR)
%    - Area Under ROC curve cho detection
%    - Computational efficiency trên large-scale streams
%    Ước tính: 1 ngày
%
% Chi tiết đầy đủ: Xem file FUTURE_EXPERIMENTS_TODO.md
% ============================================================================

Chương tiếp theo sẽ tổng kết các đóng góp chính của luận văn và đề xuất hướng phát triển trong tương lai. 
