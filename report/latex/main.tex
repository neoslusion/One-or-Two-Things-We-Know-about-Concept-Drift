\documentclass[12pt,a4paper,oneside]{report}

% Essential packages for Vietnamese thesis
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[vietnamese,english]{babel} % Vietnamese as main language
\usepackage[utf8]{vntex} % Vietnamese fonts and typography with explicit encoding
\usepackage{setspace}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{amsmath,amssymb,amsthm}

% warning notes
\usepackage{todonotes}

% Code and text alignment
\usepackage{listings}
\usepackage{ragged2e}

\lstset{
    basicstyle=\ttfamily\small,
    breaklines=true,
    breakatwhitespace=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    columns=fullflexible
}

% Color definitions for code listings (from university template)
\colorlet{punct}{red!60!black}
\definecolor{background}{HTML}{EEEEEE}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}

% JSON language definition
\lstdefinelanguage{json}{
    basicstyle=\normalfont\ttfamily,
    numbers=left,
    numberstyle=\scriptsize,
    stepnumber=1,
    numbersep=5pt,
    showstringspaces=false,
    breaklines=true,
    frame=lines,
    backgroundcolor=\color{background},
    literate=
     *{0}{{\color{numb}0}}{1}
      {1}{{\color{numb}1}}{1}
      {2}{{\color{numb}2}}{1}
      {3}{{\color{numb}3}}{1}
      {4}{{\color{numb}4}}{1}
      {5}{{\color{numb}5}}{1}
      {6}{{\color{numb}6}}{1}
      {7}{{\color{numb}7}}{1}
      {8}{{\color{numb}8}}{1}
      {9}{{\color{numb}9}}{1}
      {:}{{\color{punct}{:}}}{1}
      {,}{{\color{punct}{,}}}{1}
      {\{}{{\color{delim}{\{}}}{1}
      {\}}{{\color{delim}{\}}}}{1}
      {[}{{\color{delim}{[}}}{1}
      {]}{{\color{delim}{]}}}{1},
}

% Python style (colorful)
\lstdefinestyle{PythonStyle}{
    commentstyle=\color[rgb]{0,0.5,0},
    keywordstyle=\color[rgb]{0,0,0.8}\bfseries,
    numberstyle=\tiny\color[rgb]{0.5,0.5,0.5},
    stringstyle=\color[rgb]{0.8,0,0},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=4,
    language=Python,
    frame=single,
    backgroundcolor=\color{background}
}

% Bash style
\lstdefinestyle{BashStyle}{
    commentstyle=\color[rgb]{0,0.5,0},
    keywordstyle=\color[rgb]{0,0,0.8},
    basicstyle=\ttfamily\footnotesize,
    breaklines=true,
    numbers=left,
    numbersep=5pt,
    frame=single,
    backgroundcolor=\color{background},
    language=bash
}

% Theorem environments
\theoremstyle{plain}
\newtheorem{theorem}{Định lý}[chapter]
\newtheorem{lemma}[theorem]{Bổ đề}
\newtheorem{proposition}[theorem]{Mệnh đề}
\newtheorem{corollary}[theorem]{Hệ quả}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Định nghĩa}
\newtheorem{example}[theorem]{Ví dụ}

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Nhận xét}

\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{url}
\usepackage[sort,numbers]{natbib}
\usepackage{hyperref}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{tocloft}
\usepackage{array}
\usepackage{booktabs}
\usepackage{threeparttable}
\usepackage{multirow}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{enumitem}
\usepackage{xcolor}
\usepackage{indentfirst}
\usepackage{times} % Times New Roman font
\usepackage{anyfontsize} % For custom font sizes

% Page geometry following Vietnamese university standards
\geometry{
    left=3cm,
    right=2cm,
    top=2cm,
    bottom=2cm,
    headsep=30pt,
    footskip=1cm
}

% Figure and Table numbering by section (e.g., Hình 2.1, Bảng 3.2)
\usepackage{chngcntr}
\counterwithin{figure}{section}
\counterwithin{table}{section}

% Line spacing
\onehalfspacing

% Vietnamese paragraph formatting (using LaTeX defaults like university template)
% \parindent uses LaTeX default (~15pt for 12pt font)
\setlength{\parskip}{5pt}  % University standard

% Font settings - Times New Roman as in reference
\renewcommand{\rmdefault}{ptm} % Times New Roman
\fontfamily{ptm}\selectfont
% Set default font size to 12pt for body text
% \renewcommand{\normalsize}{\fontsize{13}{14.4}\selectfont}

% Header and Footer formatting for Vietnamese thesis (BK standard)
\pagestyle{fancy}
\fancyhf{}

% Header with university logo and department name
\fancyhead[L]{
    \begin{tabular}{rl}
        \begin{picture}(15,15)(0,0)
        \put(0,-8){\includegraphics[width=8mm, height=9mm]{image/hcmut.jpg}}
        \end{picture}&
        \begin{tabular}{l}
            Đại học Bách khoa - ĐHQG TP.HCM\\
            Khoa Khoa học \& Kỹ thuật máy tính
        \end{tabular}
    \end{tabular}
}

% Footer with thesis name and page number
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0.4pt}
\fancyfoot{}
\fancyfoot[L]{Luận văn tốt nghiệp}
\fancyfoot[R]{\thepage}
\setlength{\headheight}{30pt}

% Force ALL pages (including chapter first pages) to use fancy style
% This will be applied AFTER front matter via \enablefancyplain command
\fancypagestyle{fancyplain}{%
    \fancyhf{}
    \fancyhead[L]{
        \begin{tabular}{rl}
            \begin{picture}(15,15)(0,0)
            \put(0,-8){\includegraphics[width=8mm, height=9mm]{image/hcmut.jpg}}
            \end{picture}&
            \begin{tabular}{l}
                Đại học Bách khoa - ĐHQG TP.HCM\\
                Khoa Khoa học \& Kỹ thuật máy tính
            \end{tabular}
        \end{tabular}
    }
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0.4pt}
    \fancyfoot[L]{Luận văn tốt nghiệp}
    \fancyfoot[R]{\thepage}
}

% Simple style for front matter (only page number, no header)
\fancypagestyle{frontmatter}{%
    \fancyhf{}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
    \fancyfoot[C]{\thepage}
}

% Initially, plain style = simple (for front matter)
\fancypagestyle{plain}{%
    \fancyhf{}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
    \fancyfoot[C]{\thepage}
}

% Command to enable fancy plain style (call before main content)
\newcommand{\enablefancyplain}{%
    \fancypagestyle{plain}{%
        \fancyhf{}
        \fancyhead[L]{
            \begin{tabular}{rl}
                \begin{picture}(15,15)(0,0)
                \put(0,-8){\includegraphics[width=8mm, height=9mm]{image/hcmut.jpg}}
                \end{picture}&
                \begin{tabular}{l}
                    Đại học Bách khoa - ĐHQG TP.HCM\\
                    Khoa Khoa học \& Kỹ thuật máy tính
                \end{tabular}
            \end{tabular}
        }
        \renewcommand{\headrulewidth}{0pt}
        \renewcommand{\footrulewidth}{0.4pt}
        \fancyfoot[L]{Luận văn tốt nghiệp}
        \fancyfoot[R]{\thepage}
    }
}

% Chapter title formatting - Vietnamese style (follow DOCX format)
\titleformat{\chapter}[display]
{\raggedright\bfseries\fontsize{14}{16.8}\selectfont}
{CHƯƠNG~\thechapter}
{0.5em}
{}
\titlespacing*{\chapter}{0pt}{20pt}{15pt}

% Special formatting for unnumbered chapters (follow DOCX format)
\titleformat{name=\chapter,numberless}[display]
{\raggedright\bfseries\fontsize{14}{16.8}\selectfont}
{}
{0em}
{}
\titlespacing*{name=\chapter,numberless}{0pt}{20pt}{15pt}

% Section formatting (13pt, bold, left aligned - follow DOCX)
\titleformat{\section}[block]
{\raggedright\bfseries\fontsize{13}{15.6}\selectfont}
{\thesection}
{0.5em}
{}
\titlespacing*{\section}{0pt}{18pt}{12pt}

% Subsection formatting (12pt, bold, left aligned - follow DOCX)
\titleformat{\subsection}[block]
{\raggedright\bfseries\fontsize{13}{14.4}\selectfont}
{\thesubsection}
{0.5em}
{}
\titlespacing*{\subsection}{0pt}{12pt}{6pt}

% Subsubsection formatting (12pt, bold, left aligned)
\titleformat{\subsubsection}[block]
{\raggedright\bfseries\fontsize{13}{14.4}\selectfont}
{\thesubsubsection}
{0.5em}
{}
\titlespacing*{\subsubsection}{0pt}{12pt}{6pt}

% Table of contents formatting
\renewcommand{\contentsname}{MỤC LỤC}
\renewcommand{\listfigurename}{DANH SÁCH HÌNH VẼ}
\renewcommand{\listtablename}{DANH SÁCH BẢNG BIỂU}
\renewcommand{\bibname}{TÀI LIỆU THAM KHẢO}

% TOC formatting (12pt, bold, centered - no uppercase for titles)
\renewcommand{\cfttoctitlefont}{\centering\bfseries\fontsize{12}{14.4}\selectfont}
\renewcommand{\cftloftitlefont}{\centering\bfseries\fontsize{12}{14.4}\selectfont}
\renewcommand{\cftlottitlefont}{\centering\bfseries\fontsize{12}{14.4}\selectfont}

\renewcommand{\cftchapfont}{\bfseries}
\renewcommand{\cftsecfont}{}
\renewcommand{\cftchappagefont}{\bfseries}
\renewcommand{\cftsecpagefont}{}
\renewcommand{\cftchappresnum}{}
\renewcommand{\cftchapaftersnum}{}
\setlength{\cftchapnumwidth}{2.5cm}
\setlength{\cftbeforesecskip}{6pt}
\setlength{\cftbeforesubsecskip}{3pt}

% Dot leaders for TOC
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftsubsecleader}{\cftdotfill{\cftdotsep}}

\begin{document}

% Set up hyperref properties
\hypersetup{
    pdftitle={Nghiên cứu và phát triển hệ thống tự động phát hiện hiện tượng trôi dạt và cập nhật mô hình học máy thích ứng},
    pdfauthor={Lê Phúc Đức},
    pdfkeywords={concept drift, machine learning, adaptive systems, data stream mining},
    linkcolor=black,
    citecolor=black,
    urlcolor=blue,
    filecolor=black
}

% Front matter with roman numbering (simple style - only page number)
\pagestyle{frontmatter}
\pagenumbering{roman}
\setcounter{page}{1}

% Title page (no page number)
\input{titlepage}

% Declaration in Vietnamese
\cleardoublepage
\input{declaration}

% Vietnamese Abstract first
\cleardoublepage
\input{abstract_vietnamese}

% English Abstract
\cleardoublepage
\input{abstract}

% Acknowledgements
\cleardoublepage
\input{acknowledgements}

% Table of Contents, List of Figures, List of Tables
\cleardoublepage
\tableofcontents

\cleardoublepage
\listoffigures
\addcontentsline{toc}{chapter}{DANH SÁCH HÌNH VẼ}

\cleardoublepage
\listoftables
\addcontentsline{toc}{chapter}{DANH SÁCH BẢNG BIỂU}

% Main matter with Arabic numbering (fancy style with header/footer)
\cleardoublepage
\enablefancyplain  % Switch plain style to have header/footer
\pagestyle{fancy}
\pagenumbering{arabic}
\setcounter{page}{1}

% Main chapters
\input{chapters/00_introduction}
\input{chapters/01_related_works}
\input{chapters/02_theoretical_foundation}
\input{chapters/03_proposed_model}
\input{chapters/04_experiments_evaluation}
\input{chapters/05_conclusion_future_work}

% References
\cleardoublepage
\addcontentsline{toc}{chapter}{TÀI LIỆU THAM KHẢO}
\bibliographystyle{ieeetr}
\bibliography{references}

% Appendices
\cleardoublepage
\appendix
\input{appendix}

\end{document}
